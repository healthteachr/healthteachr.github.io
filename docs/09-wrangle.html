<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.555">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<title>Applied Data Skills - 9&nbsp; Data Wrangling</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>

<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./10-custom.html" rel="next">
<link href="./08-tidy.html" rel="prev">
<link href="./images/logos/favicon.ico" rel="icon">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark"><script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script><script async="" src="https://www.googletagmanager.com/gtag/js?id=G-6NP3MF25W3"></script><script type="text/javascript">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-6NP3MF25W3', { 'anonymize_ip': true});
</script><link rel="stylesheet" href="include/healthteachr.css">
<link rel="stylesheet" href="include/webex.css">
<link rel="stylesheet" href="include/style.css">
</head>
<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="quarto-secondary-nav"><div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./09-wrangle.html"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Data Wrangling</span></a></li></ol></nav>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto"><div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Applied Data Skills</a> 
        <div class="sidebar-tools-main tools-wide">
    <a href="https://github.com/healthteachr/healthteachr.github.io" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
    <div class="dropdown">
      <a href="" title="Share" id="quarto-navigation-tool-dropdown-0" class="quarto-navigation-tool dropdown-toggle px-1" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Share"><i class="bi bi-share"></i></a>
      <ul class="dropdown-menu" aria-labelledby="quarto-navigation-tool-dropdown-0">
<li>
            <a class="dropdown-item sidebar-tools-main-item" href="https://twitter.com/intent/tweet?url=%7Curl%7C">
              <i class="bi bi-bi-twitter pe-1"></i>
            Twitter
            </a>
          </li>
          <li>
            <a class="dropdown-item sidebar-tools-main-item" href="https://www.facebook.com/sharer/sharer.php?u=%7Curl%7C">
              <i class="bi bi-bi-facebook pe-1"></i>
            Facebook
            </a>
          </li>
          <li>
            <a class="dropdown-item sidebar-tools-main-item" href="https://www.linkedin.com/sharing/share-offsite/?url=%7Curl%7C">
              <i class="bi bi-bi-linkedin pe-1"></i>
            LinkedIn
            </a>
          </li>
      </ul>
</div>
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Overview</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01-intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Intro to R and RStudio</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02-reports.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Reports with R Markdown</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03-viz.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Data Visualisation</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04-data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Data Import</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05-summary.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Data Summaries</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./06-formative.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Practice Report</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./07-joins.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Data Relations</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./08-tidy.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Data Tidying</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./09-wrangle.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Data Wrangling</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./10-custom.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Customising Visualisations &amp; Reports</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./11-refs.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./12-license.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">License/Citation</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">Appendices</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./app-installing-r.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">A</span>&nbsp; <span class="chapter-title">Installing R</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./app-updating-r.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">B</span>&nbsp; <span class="chapter-title">Updating R, RStudio, and packages</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./app-symbols.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">C</span>&nbsp; <span class="chapter-title">Symbols</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./app-conventions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">D</span>&nbsp; <span class="chapter-title">Conventions</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./app-teams.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">E</span>&nbsp; <span class="chapter-title">Using Teams</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./app-debugging.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">F</span>&nbsp; <span class="chapter-title">Debugging</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./app-datatypes.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">G</span>&nbsp; <span class="chapter-title">Data Types</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./app-dates.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">H</span>&nbsp; <span class="chapter-title">Dates and Times</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./app-styling.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">I</span>&nbsp; <span class="chapter-title">Styling Plots</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./app-spotify.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">J</span>&nbsp; <span class="chapter-title">Spotify Data</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./app-webpage.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">K</span>&nbsp; <span class="chapter-title">Webpages</span></span></a>
  </div>
</li>
      </ul>
</li>
    </ul>
</div>
</nav><div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">Table of contents</h2>
   
  <ul>
<li><a href="#sec-ilo-wrangle" id="toc-sec-ilo-wrangle" class="nav-link active" data-scroll-target="#sec-ilo-wrangle">Intended Learning Outcomes</a></li>
  <li><a href="#sec-walkthrough-wrangle" id="toc-sec-walkthrough-wrangle" class="nav-link" data-scroll-target="#sec-walkthrough-wrangle">Walkthrough video</a></li>
  <li><a href="#sec-setup-wrangle" id="toc-sec-setup-wrangle" class="nav-link" data-scroll-target="#sec-setup-wrangle"><span class="header-section-number">9.1</span> Set-up</a></li>
  <li>
<a href="#wrangling-functions" id="toc-wrangling-functions" class="nav-link" data-scroll-target="#wrangling-functions"><span class="header-section-number">9.2</span> Wrangling functions</a>
  <ul class="collapse">
<li><a href="#select" id="toc-select" class="nav-link" data-scroll-target="#select"><span class="header-section-number">9.2.1</span> Select</a></li>
  <li><a href="#filter" id="toc-filter" class="nav-link" data-scroll-target="#filter"><span class="header-section-number">9.2.2</span> Filter</a></li>
  <li><a href="#arrange" id="toc-arrange" class="nav-link" data-scroll-target="#arrange"><span class="header-section-number">9.2.3</span> Arrange</a></li>
  <li><a href="#mutate" id="toc-mutate" class="nav-link" data-scroll-target="#mutate"><span class="header-section-number">9.2.4</span> Mutate</a></li>
  <li><a href="#sec-dplyr-summarise" id="toc-sec-dplyr-summarise" class="nav-link" data-scroll-target="#sec-dplyr-summarise"><span class="header-section-number">9.2.5</span> Summarise</a></li>
  <li><a href="#sec-dplyr-groupby" id="toc-sec-dplyr-groupby" class="nav-link" data-scroll-target="#sec-dplyr-groupby"><span class="header-section-number">9.2.6</span> Group By</a></li>
  </ul>
</li>
  <li>
<a href="#complications" id="toc-complications" class="nav-link" data-scroll-target="#complications"><span class="header-section-number">9.3</span> Complications</a>
  <ul class="collapse">
<li><a href="#rounding" id="toc-rounding" class="nav-link" data-scroll-target="#rounding"><span class="header-section-number">9.3.1</span> Rounding</a></li>
  <li><a href="#sec-missing-values" id="toc-sec-missing-values" class="nav-link" data-scroll-target="#sec-missing-values"><span class="header-section-number">9.3.2</span> Missing values</a></li>
  </ul>
</li>
  <li>
<a href="#sec-together-wrangle" id="toc-sec-together-wrangle" class="nav-link" data-scroll-target="#sec-together-wrangle"><span class="header-section-number">9.4</span> Exercises</a>
  <ul class="collapse">
<li><a href="#creating-new-categories" id="toc-creating-new-categories" class="nav-link" data-scroll-target="#creating-new-categories"><span class="header-section-number">9.4.1</span> Creating new categories</a></li>
  <li><a href="#filter-by-calculated-score" id="toc-filter-by-calculated-score" class="nav-link" data-scroll-target="#filter-by-calculated-score"><span class="header-section-number">9.4.2</span> Filter by calculated score</a></li>
  <li><a href="#multiple-critera" id="toc-multiple-critera" class="nav-link" data-scroll-target="#multiple-critera"><span class="header-section-number">9.4.3</span> Multiple critera</a></li>
  <li><a href="#original-insight" id="toc-original-insight" class="nav-link" data-scroll-target="#original-insight"><span class="header-section-number">9.4.4</span> Original insight</a></li>
  <li><a href="#report" id="toc-report" class="nav-link" data-scroll-target="#report"><span class="header-section-number">9.4.5</span> Report</a></li>
  </ul>
</li>
  <li><a href="#sec-glossary-wrangle" id="toc-sec-glossary-wrangle" class="nav-link" data-scroll-target="#sec-glossary-wrangle"><span class="header-section-number">9.5</span> Glossary</a></li>
  <li><a href="#sec-resources-wrangle" id="toc-sec-resources-wrangle" class="nav-link" data-scroll-target="#sec-resources-wrangle"><span class="header-section-number">9.6</span> Further resources</a></li>
  </ul><div class="toc-actions"><ul><li><a href="https://github.com/healthteachr/healthteachr.github.io/edit/main/09-wrangle.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/healthteachr/healthteachr.github.io/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li><li><a href="https://github.com/healthteachr/healthteachr.github.io/blob/main/09-wrangle.qmd" class="toc-action"><i class="bi empty"></i>View source</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><div class="quarto-title">
<h1 class="title"><span id="sec-wrangle" class="quarto-section-identifier"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Data Wrangling</span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header><section id="sec-ilo-wrangle" class="level2 unnumbered"><h2 class="unnumbered anchored" data-anchor-id="sec-ilo-wrangle">Intended Learning Outcomes</h2>
<ul>
<li>Be able to select and filter data for relevance</li>
<li>Be able to create new columns and edit existing ones</li>
<li>Be able to handle missing data</li>
</ul></section><section id="sec-walkthrough-wrangle" class="level2 unnumbered"><h2 class="unnumbered anchored" data-anchor-id="sec-walkthrough-wrangle">Walkthrough video</h2>
<p>There is a walkthrough video of this chapter available via <a href="https://echo360.org.uk/media/dc1e2869-a6c2-45d8-ab40-cb85cdb67f43/public">Echo360.</a> Please note that there may have been minor edits to the book since the video was recorded. Where there are differences, the book should always take precedence.</p>
</section><section id="sec-setup-wrangle" class="level2" data-number="9.1"><h2 data-number="9.1" class="anchored" data-anchor-id="sec-setup-wrangle">
<span class="header-section-number">9.1</span> Set-up</h2>
<p>First, create a new project for the work we’ll do in this chapter named <code class="path">09-wrangle</code>. Second, open and save and new R Markdown document named <code>wrangle.Rmd</code>, delete the welcome text and load the required packages for this chapter.</p>
<div class="cell" data-layout-align="center">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Chapter packages</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="fu">library</span>(tidyverse)   <span class="co"># data wrangling functions</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<p>You’ll need to make a folder called “data” and download a data file into it: <a href="https://healthteachr.github.io/data/velocity.csv" download="">velocity.csv</a>.</p>
<p>Download the <a href="https://raw.githubusercontent.com/rstudio/cheatsheets/main/data-transformation.pdf">Data transformation cheat sheet</a>.</p>
</section><section id="wrangling-functions" class="level2" data-number="9.2"><h2 data-number="9.2" class="anchored" data-anchor-id="wrangling-functions">
<span class="header-section-number">9.2</span> Wrangling functions</h2>
<p>Data wrangling refers to the process of cleaning, transforming, and restructuring your data to get it into the format you need for analysis and it’s something you will spend an awful lot of time doing. Most <a href="https://psyteachr.github.io/glossary/d#data-wrangling" target="_blank" class="glossary" title="The process of preparing data for visualisation and statistical analysis.">data wrangling</a> involves the reshaping functions you learned in <a href="08-tidy.html" class="quarto-xref"><span>Chapter 8</span></a> and six functions from the <pkg>dplyr</pkg> package that is loaded as part of the <pkg>tidyverse</pkg>: <code>select</code>, <code>filter</code>, <code>arrange</code>, <code>mutate</code>, <code>summarise</code>, and <code>group_by</code>. You’ll remember the last two from <a href="05-summary.html" class="quarto-xref"><span>Chapter 5</span></a>, so we’ll only cover them briefly.</p>
<p>It’s worth highlighting that in this chapter we’re going to cover these common functions and common uses of said functions. However, <pkg>dplyr</pkg> (and packages beyond it) has a huge number of additional wrangling functions and each function has many different arguments. Essentially, if you think you should be able to wrangle your data in a particular way that we haven’t explicitly shown you, you almost certainly can, it might just take a bit of Googling to find out how.</p>
<p>We’ll use a small example table with a sprinter’s velocity out of the blocks (m/s) and performance satisfaction for two years from three starting block positions (bunched: &lt;30 cm spacing between blocks; medium: 30-35 cm spacing between blocks; elongated: &gt;35 cm spacing between blocks) over two block angles. After you load the data, use <code>glimpse(velocity)</code> or <code>View(velocity)</code> to get familiar with the data.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a>velocity <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"data/velocity.csv"</span>, <span class="at">show_col_types =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="kable-table">
<table class="caption-top table table-sm table-striped small">
<colgroup>
<col style="width: 11%">
<col style="width: 13%">
<col style="width: 16%">
<col style="width: 16%">
<col style="width: 20%">
<col style="width: 20%">
</colgroup>
<thead><tr class="header">
<th style="text-align: left;">position</th>
<th style="text-align: left;">angle</th>
<th style="text-align: right;">velocity_2022</th>
<th style="text-align: right;">velocity_2023</th>
<th style="text-align: left;">satisfaction_2022</th>
<th style="text-align: left;">satisfaction_2023</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">bunched</td>
<td style="text-align: left;">&lt;50 degrees</td>
<td style="text-align: right;">3.03</td>
<td style="text-align: right;">3.00</td>
<td style="text-align: left;">low</td>
<td style="text-align: left;">very low</td>
</tr>
<tr class="even">
<td style="text-align: left;">bunched</td>
<td style="text-align: left;">&gt;50 degrees</td>
<td style="text-align: right;">2.90</td>
<td style="text-align: right;">3.34</td>
<td style="text-align: left;">very low</td>
<td style="text-align: left;">very high</td>
</tr>
<tr class="odd">
<td style="text-align: left;">medium</td>
<td style="text-align: left;">&lt;50 degrees</td>
<td style="text-align: right;">3.30</td>
<td style="text-align: right;">3.51</td>
<td style="text-align: left;">very high</td>
<td style="text-align: left;">very high</td>
</tr>
<tr class="even">
<td style="text-align: left;">medium</td>
<td style="text-align: left;">&gt;50 degrees</td>
<td style="text-align: right;">3.03</td>
<td style="text-align: right;">3.10</td>
<td style="text-align: left;">high</td>
<td style="text-align: left;">low</td>
</tr>
<tr class="odd">
<td style="text-align: left;">elongated</td>
<td style="text-align: left;">&lt;50 degrees</td>
<td style="text-align: right;">3.01</td>
<td style="text-align: right;">3.46</td>
<td style="text-align: left;">neutral</td>
<td style="text-align: left;">high</td>
</tr>
<tr class="even">
<td style="text-align: left;">elongated</td>
<td style="text-align: left;">&gt;50 degrees</td>
<td style="text-align: right;">3.30</td>
<td style="text-align: right;">3.25</td>
<td style="text-align: left;">high</td>
<td style="text-align: left;">neutral</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<section id="select" class="level3" data-number="9.2.1"><h3 data-number="9.2.1" class="anchored" data-anchor-id="select">
<span class="header-section-number">9.2.1</span> Select</h3>
<p>You can select a subset of the columns (variables) in a table to make it easier to view or to prepare a table for display. You can also select columns in a new order.</p>
<section id="by-name-or-index" class="level4"><h4 class="anchored" data-anchor-id="by-name-or-index">By name or index</h4>
<p>You can select columns by name or number (which is sometimes referred to as the column index). Selecting by number can be useful when the column names are long or complicated.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a><span class="co"># select single column by name</span></span>
<span id="cb3-2"><a href="#cb3-2"></a>block_angle_dat <span class="ot">&lt;-</span> velocity <span class="sc">%&gt;%</span> <span class="fu">select</span>(angle) </span>
<span id="cb3-3"><a href="#cb3-3"></a></span>
<span id="cb3-4"><a href="#cb3-4"></a><span class="co"># select single column by number</span></span>
<span id="cb3-5"><a href="#cb3-5"></a>block_angle_dat <span class="ot">&lt;-</span> velocity <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="dv">2</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>You can select each column individually, separated by commas (e.g., <code>position, velocity_2022</code>) but you can also select all columns from one to another by separating them with a colon (e.g., <code>velocity_2022:satisfaction_2023</code>).</p>
<p>The colon notation can be much faster because you don’t need to type out each individual variable name, but make sure that you know what order your columns are in and always check the output to make sure you have selected what you intended.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a><span class="co"># select columns individually</span></span>
<span id="cb4-2"><a href="#cb4-2"></a>velocity2022 <span class="ot">&lt;-</span> velocity <span class="sc">%&gt;%</span> <span class="fu">select</span>(position, angle, velocity_2022)</span>
<span id="cb4-3"><a href="#cb4-3"></a></span>
<span id="cb4-4"><a href="#cb4-4"></a><span class="co"># select columns with colon</span></span>
<span id="cb4-5"><a href="#cb4-5"></a>velocity2022 <span class="ot">&lt;-</span> velocity <span class="sc">%&gt;%</span> <span class="fu">select</span>(position<span class="sc">:</span>velocity_2022)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>You can rename columns at the same time as selecting them by setting <code>new_name = old_col</code>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a>positions <span class="ot">&lt;-</span> velocity <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="st">`</span><span class="at">Space between blocks</span><span class="st">`</span> <span class="ot">=</span> <span class="dv">1</span>, <span class="dv">3</span><span class="sc">:</span><span class="dv">6</span>)</span>
<span id="cb5-2"><a href="#cb5-2"></a></span>
<span id="cb5-3"><a href="#cb5-3"></a><span class="fu">head</span>(positions, <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="kable-table">
<table class="caption-top table table-sm table-striped small">
<colgroup>
<col style="width: 24%">
<col style="width: 16%">
<col style="width: 16%">
<col style="width: 21%">
<col style="width: 21%">
</colgroup>
<thead><tr class="header">
<th style="text-align: left;">Space between blocks</th>
<th style="text-align: right;">velocity_2022</th>
<th style="text-align: right;">velocity_2023</th>
<th style="text-align: left;">satisfaction_2022</th>
<th style="text-align: left;">satisfaction_2023</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">bunched</td>
<td style="text-align: right;">3.03</td>
<td style="text-align: right;">3.00</td>
<td style="text-align: left;">low</td>
<td style="text-align: left;">very low</td>
</tr>
<tr class="even">
<td style="text-align: left;">bunched</td>
<td style="text-align: right;">2.90</td>
<td style="text-align: right;">3.34</td>
<td style="text-align: left;">very low</td>
<td style="text-align: left;">very high</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</section><section id="un-selecting-columns" class="level4"><h4 class="anchored" data-anchor-id="un-selecting-columns">Un-selecting columns</h4>
<p>You can select columns either by telling R which ones you want to keep as in the previous examples, or by specifying which ones you want to exclude by using a minus symbol to un-select columns. You can also use the colon notation to de-select columns, but to do so you need to put parentheses around the span first, e.g., <code>-(velocity_2022:velocity_2023)</code>, not <code>-velocity_2022:velocity_2023</code>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1"></a><span class="co"># de-select individual columns</span></span>
<span id="cb6-2"><a href="#cb6-2"></a>satisfaction <span class="ot">&lt;-</span> velocity <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>velocity_2022, <span class="sc">-</span>velocity_2023)</span>
<span id="cb6-3"><a href="#cb6-3"></a></span>
<span id="cb6-4"><a href="#cb6-4"></a><span class="co"># de-select a range of columns</span></span>
<span id="cb6-5"><a href="#cb6-5"></a>satisfaction <span class="ot">&lt;-</span> velocity <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>(velocity_2022<span class="sc">:</span>velocity_2023))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="select-helpers" class="level4"><h4 class="anchored" data-anchor-id="select-helpers">Select helpers</h4>
<p>Finally, you can select columns based on criteria about the column names.</p>
<table class="caption-top table">
<colgroup>
<col style="width: 45%">
<col style="width: 54%">
</colgroup>
<thead><tr class="header">
<th>function</th>
<th>definition</th>
</tr></thead>
<tbody>
<tr class="odd">
<td><code>starts_with()</code></td>
<td>select columns that start with a character string</td>
</tr>
<tr class="even">
<td><code>ends_with()</code></td>
<td>select columns that end with a character string</td>
</tr>
<tr class="odd">
<td><code>contains()</code></td>
<td>select columns that contain a character string</td>
</tr>
<tr class="even">
<td><code>num_range()</code></td>
<td>select columns with a name that matches the pattern <code>prefix</code>
</td>
</tr>
</tbody>
</table>
<div class="try callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>What are the resulting columns for these four examples?</p>
<ul>
<li>
<code>velocity %&gt;% select(contains("_"))</code>
<div id="radio_HPGULKIFEW" class="webex-radiogroup">
<label><input type="radio" autocomplete="off" name="radio_HPGULKIFEW" value="x"><span>velocity_2022, velocity_2023</span></label><label><input type="radio" autocomplete="off" name="radio_HPGULKIFEW" value="x"><span>velocity_2023, satisfaction_2023</span></label><label><input type="radio" autocomplete="off" name="radio_HPGULKIFEW" value="answer"><span>velocity_2022, velocity_2023, satisfaction_2022, satisfaction_2023</span></label><label><input type="radio" autocomplete="off" name="radio_HPGULKIFEW" value="x"><span>velocity_2022, velocity_2023</span></label>
</div>
</li>
<li>
<code>velocity %&gt;% select(num_range("velocity_", 2022:2023))</code>
<div id="radio_RFBFHPFVRC" class="webex-radiogroup">
<label><input type="radio" autocomplete="off" name="radio_RFBFHPFVRC" value="x"><span>velocity_2022, velocity_2023</span></label><label><input type="radio" autocomplete="off" name="radio_RFBFHPFVRC" value="x"><span>velocity_2023, satisfaction_2023</span></label><label><input type="radio" autocomplete="off" name="radio_RFBFHPFVRC" value="x"><span>velocity_2022, velocity_2023, satisfaction_2022, satisfaction_2023</span></label><label><input type="radio" autocomplete="off" name="radio_RFBFHPFVRC" value="answer"><span>velocity_2022, velocity_2023</span></label>
</div>
</li>
<li>
<code>velocity %&gt;% select(starts_with("velocity"))</code>
<div id="radio_KLNBFZRFRE" class="webex-radiogroup">
<label><input type="radio" autocomplete="off" name="radio_KLNBFZRFRE" value="answer"><span>velocity_2022, velocity_2023</span></label><label><input type="radio" autocomplete="off" name="radio_KLNBFZRFRE" value="x"><span>velocity_2023, satisfaction_2023</span></label><label><input type="radio" autocomplete="off" name="radio_KLNBFZRFRE" value="x"><span>velocity_2022, velocity_2023, satisfaction_2022, satisfaction_2023</span></label><label><input type="radio" autocomplete="off" name="radio_KLNBFZRFRE" value="x"><span>velocity_2022, velocity_2023</span></label>
</div>
</li>
<li>
<code>velocity %&gt;% select(ends_with("2023"))</code>
<div id="radio_ORHZRFJBTD" class="webex-radiogroup">
<label><input type="radio" autocomplete="off" name="radio_ORHZRFJBTD" value="x"><span>velocity_2022, velocity_2023</span></label><label><input type="radio" autocomplete="off" name="radio_ORHZRFJBTD" value="answer"><span>velocity_2023, satisfaction_2023</span></label><label><input type="radio" autocomplete="off" name="radio_ORHZRFJBTD" value="x"><span>velocity_2022, velocity_2023, satisfaction_2022, satisfaction_2023</span></label><label><input type="radio" autocomplete="off" name="radio_ORHZRFJBTD" value="x"><span>velocity_2022, velocity_2023</span></label>
</div>
</li>
</ul>
</div>
</div>
</section></section><section id="filter" class="level3" data-number="9.2.2"><h3 data-number="9.2.2" class="anchored" data-anchor-id="filter">
<span class="header-section-number">9.2.2</span> Filter</h3>
<p>Whilst <code>select()</code> chooses the columns you want to retain, <code><a href="https://rdrr.io/r/stats/filter.html">filter()</a></code> chooses the rows to retain by matching row or column criteria.</p>
<p>You can filter by a single criterion. This criterion can be rows where a certain column’s value matches a character value (e.g., “elongated”) or a number (e.g., 3.51). It can also be the result of a logical equation (e.g., keep all rows with a specific column value larger than a certain value). The criterion is checked for each row, and if the result is FALSE, the row is removed. You can reverse equations by specifying <code>!=</code> where <code>!</code> means “not”.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a><span class="co"># select all rows where position equals elongated</span></span>
<span id="cb7-2"><a href="#cb7-2"></a>velocity <span class="sc">%&gt;%</span> <span class="fu">filter</span>(position <span class="sc">==</span> <span class="st">"elongated"</span>)</span>
<span id="cb7-3"><a href="#cb7-3"></a></span>
<span id="cb7-4"><a href="#cb7-4"></a><span class="co"># select all rows where velocity_2023 was exactly equal to 3.51</span></span>
<span id="cb7-5"><a href="#cb7-5"></a>velocity <span class="sc">%&gt;%</span> <span class="fu">filter</span>(velocity_2023 <span class="sc">==</span> <span class="fl">3.51</span>)</span>
<span id="cb7-6"><a href="#cb7-6"></a></span>
<span id="cb7-7"><a href="#cb7-7"></a><span class="co"># select all rows where velocity_2022 was more than 3.1</span></span>
<span id="cb7-8"><a href="#cb7-8"></a>velocity <span class="sc">%&gt;%</span> <span class="fu">filter</span>(velocity_2022 <span class="sc">&gt;</span> <span class="fl">3.1</span>)</span>
<span id="cb7-9"><a href="#cb7-9"></a></span>
<span id="cb7-10"><a href="#cb7-10"></a><span class="co"># everything but the elongated starting block position</span></span>
<span id="cb7-11"><a href="#cb7-11"></a>velocity <span class="sc">%&gt;%</span> <span class="fu">filter</span>(position <span class="sc">!=</span> <span class="st">"elongated"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Warning
</div>
</div>
<div class="callout-body-container callout-body">
<p>Remember to use <code>==</code> and not <code>=</code> to check if two things are equivalent. A single <code>=</code> assigns the right-hand value to the left-hand variable (much like the <code>&lt;-</code> operator).</p>
</div>
</div>
<div class="try callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>Which IDs are kept from the table below?</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="kable-table">
<table class="caption-top table table-sm table-striped small">
<thead><tr class="header">
<th style="text-align: right;">id</th>
<th style="text-align: left;">grade</th>
<th style="text-align: right;">score</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: left;">A</td>
<td style="text-align: right;">95</td>
</tr>
<tr class="even">
<td style="text-align: right;">2</td>
<td style="text-align: left;">A</td>
<td style="text-align: right;">91</td>
</tr>
<tr class="odd">
<td style="text-align: right;">3</td>
<td style="text-align: left;">C</td>
<td style="text-align: right;">76</td>
</tr>
<tr class="even">
<td style="text-align: right;">4</td>
<td style="text-align: left;">B</td>
<td style="text-align: right;">84</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<ul>
<li>
<code>demo %&gt;% filter(score &lt; 80)</code> <select class="webex-select"><option value="blank"></option>
<option value="x">1, 2</option>
<option value="x">2</option>
<option value="answer">3</option>
<option value="x">3, 4</option></select>
</li>
<li>
<code>demo %&gt;% filter(grade == "A")</code> <select class="webex-select"><option value="blank"></option>
<option value="answer">1, 2</option>
<option value="x">2</option>
<option value="x">3</option>
<option value="x">3, 4</option></select>
</li>
<li>
<code>demo %&gt;% filter(grade != "A")</code> <select class="webex-select"><option value="blank"></option>
<option value="x">1, 2</option>
<option value="x">2</option>
<option value="x">3</option>
<option value="answer">3, 4</option></select>
</li>
<li>
<code>demo %&gt;% filter(score == 91)</code> <select class="webex-select"><option value="blank"></option>
<option value="x">1, 2</option>
<option value="answer">2</option>
<option value="x">3</option>
<option value="x">3, 4</option></select>
</li>
</ul>
</div>
</div>
<p>You can also select on multiple criteria by separating them by commas (rows will be kept if they match <em>all</em> criteria). Additionally, you can use <code>&amp;</code> (“and”) and <code>|</code> (“or”) to create complex criteria.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1"></a><span class="co"># positions and angles with improvement in velocity from 2022 to 2023 and with "very high" satisfaction in 2023</span></span>
<span id="cb8-2"><a href="#cb8-2"></a>improvement_and_satisfaction <span class="ot">&lt;-</span> velocity <span class="sc">%&gt;%</span> </span>
<span id="cb8-3"><a href="#cb8-3"></a>  <span class="fu">filter</span>(</span>
<span id="cb8-4"><a href="#cb8-4"></a>    velocity_2023 <span class="sc">&gt;</span> velocity_2022,</span>
<span id="cb8-5"><a href="#cb8-5"></a>    satisfaction_2023<span class="sc">==</span><span class="st">"very high"</span></span>
<span id="cb8-6"><a href="#cb8-6"></a>  )</span>
<span id="cb8-7"><a href="#cb8-7"></a></span>
<span id="cb8-8"><a href="#cb8-8"></a><span class="co"># the same as above, using &amp; instead of a comma</span></span>
<span id="cb8-9"><a href="#cb8-9"></a>improvement_and_satisfaction <span class="ot">&lt;-</span> velocity <span class="sc">%&gt;%</span> </span>
<span id="cb8-10"><a href="#cb8-10"></a>  <span class="fu">filter</span>(</span>
<span id="cb8-11"><a href="#cb8-11"></a>    velocity_2023 <span class="sc">&gt;</span> velocity_2022 <span class="sc">&amp;</span></span>
<span id="cb8-12"><a href="#cb8-12"></a>    satisfaction_2023<span class="sc">==</span><span class="st">"very high"</span></span>
<span id="cb8-13"><a href="#cb8-13"></a>  )</span>
<span id="cb8-14"><a href="#cb8-14"></a></span>
<span id="cb8-15"><a href="#cb8-15"></a><span class="co"># positions and angles with improvement in velocity from 2022 to 2023 or with "very high" satisfaction in 2023</span></span>
<span id="cb8-16"><a href="#cb8-16"></a>improvement_or_satisfaction <span class="ot">&lt;-</span> velocity <span class="sc">%&gt;%</span> </span>
<span id="cb8-17"><a href="#cb8-17"></a>  <span class="fu">filter</span>(</span>
<span id="cb8-18"><a href="#cb8-18"></a>    velocity_2023 <span class="sc">&gt;</span> velocity_2022 <span class="sc">|</span></span>
<span id="cb8-19"><a href="#cb8-19"></a>    satisfaction_2023<span class="sc">==</span><span class="st">"very high"</span></span>
<span id="cb8-20"><a href="#cb8-20"></a>  )</span>
<span id="cb8-21"><a href="#cb8-21"></a></span>
<span id="cb8-22"><a href="#cb8-22"></a><span class="co"># Improvement in velocity between 2022 and 2023 greater than 0.2 m/s</span></span>
<span id="cb8-23"><a href="#cb8-23"></a>big_improvement <span class="ot">&lt;-</span> velocity <span class="sc">%&gt;%</span></span>
<span id="cb8-24"><a href="#cb8-24"></a>  <span class="fu">filter</span>(velocity_2023 <span class="sc">-</span> velocity_2022 <span class="sc">&gt;</span> <span class="fl">0.2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>If you want the filter to retain multiple specific values in the same variable, the <a href="https://psyteachr.github.io/glossary/m#match-operator" target="_blank" class="glossary" title="A binary operator (%in%) that returns a logical vector indicating if there is a match or not for its left operand.">match operator</a> (<code>%in%</code>) should be used rather than <code>|</code> (or). The <code>!</code> can also be used in combination here, but it is placed before the variable name.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1"></a><span class="co"># retain any rows where position is bunched or medium, and where angle equals &lt;50 degrees</span></span>
<span id="cb9-2"><a href="#cb9-2"></a>velocity <span class="sc">%&gt;%</span></span>
<span id="cb9-3"><a href="#cb9-3"></a>  <span class="fu">filter</span>(position <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"bunched"</span>, <span class="st">"medium"</span>),</span>
<span id="cb9-4"><a href="#cb9-4"></a>         angle <span class="sc">==</span> <span class="st">"&lt;50 degrees"</span>)</span>
<span id="cb9-5"><a href="#cb9-5"></a></span>
<span id="cb9-6"><a href="#cb9-6"></a><span class="co"># retain any rows where the position is not elongated, and where the angle does not equal &lt;50 degrees</span></span>
<span id="cb9-7"><a href="#cb9-7"></a>velocity <span class="sc">%&gt;%</span></span>
<span id="cb9-8"><a href="#cb9-8"></a>  <span class="fu">filter</span>(<span class="sc">!</span>position <span class="sc">%in%</span> <span class="st">"elongated"</span>,</span>
<span id="cb9-9"><a href="#cb9-9"></a>         angle <span class="sc">!=</span> <span class="st">"&lt;50 degrees"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<table class="caption-top table">
<colgroup>
<col style="width: 16%">
<col style="width: 33%">
<col style="width: 50%">
</colgroup>
<thead><tr class="header">
<th><a href="https://psyteachr.github.io/glossary/o#operator" target="_blank" class="glossary" title="A symbol that performs some mathematical or comparative process.">Operator</a></th>
<th>Name</th>
<th>is TRUE if and only if</th>
</tr></thead>
<tbody>
<tr class="odd">
<td><code>A &lt; B</code></td>
<td>less than</td>
<td>A is less than B</td>
</tr>
<tr class="even">
<td><code>A &lt;= B</code></td>
<td>less than or equal</td>
<td>A is less than or equal to B</td>
</tr>
<tr class="odd">
<td><code>A &gt; B</code></td>
<td>greater than</td>
<td>A is greater than B</td>
</tr>
<tr class="even">
<td><code>A &gt;= B</code></td>
<td>greater than or equal</td>
<td>A is greater than or equal to B</td>
</tr>
<tr class="odd">
<td><code>A == B</code></td>
<td>equivalence</td>
<td>A exactly equals B</td>
</tr>
<tr class="even">
<td><code>A != B</code></td>
<td>not equal</td>
<td>A does not exactly equal B</td>
</tr>
<tr class="odd">
<td><code>A %in% B</code></td>
<td>in</td>
<td>A is an element of vector B</td>
</tr>
</tbody>
</table>
<p>Finally, you can also pass many other functions to filter. For example, the package <pkg>stringr</pkg> that is loaded as part of the <pkg>tidyverse</pkg> contains many different functions for working with <a href="https://psyteachr.github.io/glossary/s#string" target="_blank" class="glossary" title="A piece of text inside of quotes.">strings</a> (character data). For example, you you use <code>str_detect()</code> to only retain rows where the performance satisfaction rating includes the word “high”.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1"></a>velocity <span class="sc">%&gt;%</span></span>
<span id="cb10-2"><a href="#cb10-2"></a>  <span class="fu">filter</span>(<span class="fu">str_detect</span>(satisfaction_2022, <span class="st">"high"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="kable-table">
<table class="caption-top table table-sm table-striped small">
<colgroup>
<col style="width: 11%">
<col style="width: 13%">
<col style="width: 16%">
<col style="width: 16%">
<col style="width: 20%">
<col style="width: 20%">
</colgroup>
<thead><tr class="header">
<th style="text-align: left;">position</th>
<th style="text-align: left;">angle</th>
<th style="text-align: right;">velocity_2022</th>
<th style="text-align: right;">velocity_2023</th>
<th style="text-align: left;">satisfaction_2022</th>
<th style="text-align: left;">satisfaction_2023</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">medium</td>
<td style="text-align: left;">&lt;50 degrees</td>
<td style="text-align: right;">3.30</td>
<td style="text-align: right;">3.51</td>
<td style="text-align: left;">very high</td>
<td style="text-align: left;">very high</td>
</tr>
<tr class="even">
<td style="text-align: left;">medium</td>
<td style="text-align: left;">&gt;50 degrees</td>
<td style="text-align: right;">3.03</td>
<td style="text-align: right;">3.10</td>
<td style="text-align: left;">high</td>
<td style="text-align: left;">low</td>
</tr>
<tr class="odd">
<td style="text-align: left;">elongated</td>
<td style="text-align: left;">&gt;50 degrees</td>
<td style="text-align: right;">3.30</td>
<td style="text-align: right;">3.25</td>
<td style="text-align: left;">high</td>
<td style="text-align: left;">neutral</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>Note that <code>str_detect()</code> is case sensitive so it would not return values of “High” or “HIGH”. You can use the function <code><a href="https://rdrr.io/r/base/chartr.html">tolower()</a></code> or <code><a href="https://rdrr.io/r/base/chartr.html">toupper()</a></code> to convert a string to lowercase or uppercase before you search for substring if you need case-insensitive matching.</p>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Warning
</div>
</div>
<div class="callout-body-container callout-body">
<p><code><a href="https://rdrr.io/r/stats/filter.html">filter()</a></code> is incredibly powerful and can allow you to select very specific subsets of data. But, it is also quite dangerous because when you start combining multiple criteria and operators, it’s very easy to accidentally specify something slightly different than what you intended. <strong>Always check your output</strong>. If you have a small dataset, then you can eyeball it to see if it looks right. With a larger dataset, you may wish to compute summary statistics or count the number of groups/observations in each variable to verify your filter is correct. There is no level of expertise in coding that can substitute knowing and checking your data.</p>
</div>
</div>
</section><section id="arrange" class="level3" data-number="9.2.3"><h3 data-number="9.2.3" class="anchored" data-anchor-id="arrange">
<span class="header-section-number">9.2.3</span> Arrange</h3>
<p>You can sort your dataset using <code>arrange()</code>. You will find yourself needing to sort data in R much less than you do in Excel, since you don’t need to have rows next to each other in order to, for example, calculate group means. But <code>arrange()</code> can be useful when preparing data for display in tables. <code>arrange()</code> works on character data where it will sort alphabetically, as well as numeric data where the default is ascending order (smallest to largest). Reverse the order using <code>desc()</code>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1"></a><span class="co"># arranging the table </span></span>
<span id="cb11-2"><a href="#cb11-2"></a><span class="co"># first by angle in alphabetical order</span></span>
<span id="cb11-3"><a href="#cb11-3"></a><span class="co"># then by "position" in reverse alphabetical order</span></span>
<span id="cb11-4"><a href="#cb11-4"></a>velocity <span class="sc">%&gt;%</span></span>
<span id="cb11-5"><a href="#cb11-5"></a>  <span class="fu">arrange</span>(angle, <span class="fu">desc</span>(position))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="kable-table">
<table class="caption-top table table-sm table-striped small">
<colgroup>
<col style="width: 11%">
<col style="width: 13%">
<col style="width: 16%">
<col style="width: 16%">
<col style="width: 20%">
<col style="width: 20%">
</colgroup>
<thead><tr class="header">
<th style="text-align: left;">position</th>
<th style="text-align: left;">angle</th>
<th style="text-align: right;">velocity_2022</th>
<th style="text-align: right;">velocity_2023</th>
<th style="text-align: left;">satisfaction_2022</th>
<th style="text-align: left;">satisfaction_2023</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">medium</td>
<td style="text-align: left;">&lt;50 degrees</td>
<td style="text-align: right;">3.30</td>
<td style="text-align: right;">3.51</td>
<td style="text-align: left;">very high</td>
<td style="text-align: left;">very high</td>
</tr>
<tr class="even">
<td style="text-align: left;">elongated</td>
<td style="text-align: left;">&lt;50 degrees</td>
<td style="text-align: right;">3.01</td>
<td style="text-align: right;">3.46</td>
<td style="text-align: left;">neutral</td>
<td style="text-align: left;">high</td>
</tr>
<tr class="odd">
<td style="text-align: left;">bunched</td>
<td style="text-align: left;">&lt;50 degrees</td>
<td style="text-align: right;">3.03</td>
<td style="text-align: right;">3.00</td>
<td style="text-align: left;">low</td>
<td style="text-align: left;">very low</td>
</tr>
<tr class="even">
<td style="text-align: left;">medium</td>
<td style="text-align: left;">&gt;50 degrees</td>
<td style="text-align: right;">3.03</td>
<td style="text-align: right;">3.10</td>
<td style="text-align: left;">high</td>
<td style="text-align: left;">low</td>
</tr>
<tr class="odd">
<td style="text-align: left;">elongated</td>
<td style="text-align: left;">&gt;50 degrees</td>
<td style="text-align: right;">3.30</td>
<td style="text-align: right;">3.25</td>
<td style="text-align: left;">high</td>
<td style="text-align: left;">neutral</td>
</tr>
<tr class="even">
<td style="text-align: left;">bunched</td>
<td style="text-align: left;">&gt;50 degrees</td>
<td style="text-align: right;">2.90</td>
<td style="text-align: right;">3.34</td>
<td style="text-align: left;">very low</td>
<td style="text-align: left;">very high</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="try callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>If you want to sort character data/categories in a specific order, turn the column into a <a href="https://psyteachr.github.io/glossary/f#factor" target="_blank" class="glossary" title="A data type where a specific set of values are stored with labels; An explanatory variable manipulated by the experimenter">factor</a> and set the <code>levels</code> in the desired order.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1"></a>velocity <span class="sc">%&gt;%</span></span>
<span id="cb12-2"><a href="#cb12-2"></a>  <span class="fu">mutate</span>(<span class="at">position =</span> <span class="fu">factor</span>(position, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"bunched"</span>, <span class="st">"medium"</span>, <span class="st">"elongated"</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb12-3"><a href="#cb12-3"></a>  <span class="fu">filter</span>(angle <span class="sc">==</span> <span class="st">"&gt;50 degrees"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb12-4"><a href="#cb12-4"></a>  <span class="fu">arrange</span>(position)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="kable-table">
<table class="caption-top table table-sm table-striped small">
<colgroup>
<col style="width: 11%">
<col style="width: 13%">
<col style="width: 16%">
<col style="width: 16%">
<col style="width: 20%">
<col style="width: 20%">
</colgroup>
<thead><tr class="header">
<th style="text-align: left;">position</th>
<th style="text-align: left;">angle</th>
<th style="text-align: right;">velocity_2022</th>
<th style="text-align: right;">velocity_2023</th>
<th style="text-align: left;">satisfaction_2022</th>
<th style="text-align: left;">satisfaction_2023</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">bunched</td>
<td style="text-align: left;">&gt;50 degrees</td>
<td style="text-align: right;">2.90</td>
<td style="text-align: right;">3.34</td>
<td style="text-align: left;">very low</td>
<td style="text-align: left;">very high</td>
</tr>
<tr class="even">
<td style="text-align: left;">medium</td>
<td style="text-align: left;">&gt;50 degrees</td>
<td style="text-align: right;">3.03</td>
<td style="text-align: right;">3.10</td>
<td style="text-align: left;">high</td>
<td style="text-align: left;">low</td>
</tr>
<tr class="odd">
<td style="text-align: left;">elongated</td>
<td style="text-align: left;">&gt;50 degrees</td>
<td style="text-align: right;">3.30</td>
<td style="text-align: right;">3.25</td>
<td style="text-align: left;">high</td>
<td style="text-align: left;">neutral</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
</div>
</section><section id="mutate" class="level3" data-number="9.2.4"><h3 data-number="9.2.4" class="anchored" data-anchor-id="mutate">
<span class="header-section-number">9.2.4</span> Mutate</h3>
<p>The function <code>mutate()</code> allows you to add new columns or change existing ones by overwriting them by using the syntax <code>new_column = operation</code>. You can add more than one column in the same mutate function by separating the columns with a comma. Once you make a new column, you can use it in further column definitions. For example, the creation of <code>improvement_percent</code> below uses the column <code>improvement_raw</code>, which is created above it.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1"></a>velocity2 <span class="ot">&lt;-</span> velocity <span class="sc">%&gt;%</span></span>
<span id="cb13-2"><a href="#cb13-2"></a>  <span class="fu">mutate</span>(</span>
<span id="cb13-3"><a href="#cb13-3"></a>    <span class="at">improvement_raw =</span> velocity_2023 <span class="sc">-</span> velocity_2022,</span>
<span id="cb13-4"><a href="#cb13-4"></a>    <span class="at">improvement_percent =</span> (improvement_raw <span class="sc">/</span> velocity_2022) <span class="sc">*</span> <span class="dv">100</span>,</span>
<span id="cb13-5"><a href="#cb13-5"></a>    <span class="at">position =</span> <span class="fu">paste</span>(position, <span class="st">"start"</span>)</span>
<span id="cb13-6"><a href="#cb13-6"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><code>mutate()</code> can also be used in conjunction with other functions and Boolean operators. For example, we can add another column to <code>velocity2</code> that states whether there was an improvement in velocity out of the blocks that year or overwrite our <code>angle</code> variable as a factor. Just like when we used <a href="https://psyteachr.github.io/glossary/b#boolean-expression" target="_blank" class="glossary" title="An expression that evaluates to TRUE or FALSE.">Boolean expressions</a> with filter, it will evaluate the equation and return TRUE or FALSE depending on whether the observation meets the criteria.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1"></a>velocity2 <span class="ot">&lt;-</span> velocity2 <span class="sc">%&gt;%</span></span>
<span id="cb14-2"><a href="#cb14-2"></a>  <span class="fu">mutate</span>(<span class="at">improvement_category =</span> improvement_raw <span class="sc">&gt;</span> <span class="dv">0</span>,</span>
<span id="cb14-3"><a href="#cb14-3"></a>         <span class="at">angle =</span> <span class="fu">as.factor</span>(angle))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Warning
</div>
</div>
<div class="callout-body-container callout-body">
<p>You can overwrite a column by giving a new column the same name as the old column (see <code>position</code> or <code>angle</code>) above. Make sure that you mean to do this and that you aren’t trying to use the old column value after you redefine it.</p>
</div>
</div>
<p>You can also use <code>case_when()</code> to specify what values to return, rather than defaulting to TRUE or FALSE:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1"></a>velocity3 <span class="ot">&lt;-</span> velocity2 <span class="sc">%&gt;%</span></span>
<span id="cb15-2"><a href="#cb15-2"></a>  <span class="fu">mutate</span>(<span class="at">improvement_category =</span> <span class="fu">case_when</span>(improvement_raw <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">~</span> <span class="st">"IMPROVEMENT"</span>,</span>
<span id="cb15-3"><a href="#cb15-3"></a>                                     improvement_raw <span class="sc">&lt;</span> <span class="dv">0</span> <span class="sc">~</span> <span class="st">"NO IMPROVEMENT"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Use it to recode values:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1"></a><span class="co"># create a column where coaches get a bonus if the sprinter's performance satisfaction was overall high or very high</span></span>
<span id="cb16-2"><a href="#cb16-2"></a></span>
<span id="cb16-3"><a href="#cb16-3"></a>bonus <span class="ot">&lt;-</span> velocity3 <span class="sc">%&gt;%</span></span>
<span id="cb16-4"><a href="#cb16-4"></a>  <span class="fu">mutate</span>(<span class="at">bonus_2022 =</span> <span class="fu">case_when</span>(satisfaction_2022 <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"very low"</span>, <span class="st">"low"</span>, <span class="st">"neutral"</span>) <span class="sc">~</span> <span class="st">"no bonus"</span>,</span>
<span id="cb16-5"><a href="#cb16-5"></a>                                satisfaction_2022 <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"high"</span>, <span class="st">"very high"</span>) <span class="sc">~</span> <span class="st">"bonus"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>And combine different criteria:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1"></a><span class="co"># new club management takes over - coaches only get a bonus if performance satisfaction was overall high or very high AND there was an improvement in performance</span></span>
<span id="cb17-2"><a href="#cb17-2"></a></span>
<span id="cb17-3"><a href="#cb17-3"></a>bonus2 <span class="ot">&lt;-</span> velocity3 <span class="sc">%&gt;%</span></span>
<span id="cb17-4"><a href="#cb17-4"></a>  <span class="fu">mutate</span>(<span class="at">bonus_2023 =</span> <span class="fu">case_when</span>(satisfaction_2023 <span class="sc">==</span> <span class="st">"high"</span> <span class="sc">&amp;</span> </span>
<span id="cb17-5"><a href="#cb17-5"></a>                                  improvement_category <span class="sc">==</span> <span class="st">"IMPROVEMENT"</span> <span class="sc">~</span> <span class="st">"bonus"</span>,</span>
<span id="cb17-6"><a href="#cb17-6"></a>                                satisfaction_2023 <span class="sc">==</span> <span class="st">"very high"</span> <span class="sc">&amp;</span> </span>
<span id="cb17-7"><a href="#cb17-7"></a>                                  improvement_category <span class="sc">==</span> <span class="st">"IMPROVEMENT"</span> <span class="sc">~</span> <span class="st">"bonus"</span>,</span>
<span id="cb17-8"><a href="#cb17-8"></a>                                <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"No bonus"</span>)) <span class="co"># set all other values to "no bonus"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Just like <code><a href="https://rdrr.io/r/stats/filter.html">filter()</a></code>, <code>mutate()</code> is incredibly powerful and the scope of what you can create is far beyond what we can cover in this book.</p>
</section><section id="sec-dplyr-summarise" class="level3" data-number="9.2.5"><h3 data-number="9.2.5" class="anchored" data-anchor-id="sec-dplyr-summarise">
<span class="header-section-number">9.2.5</span> Summarise</h3>
<p>You were introduced to the <code>summarise()</code> function in <a href="05-summary.html#sec-summary-summarise" class="quarto-xref"><span>Section 5.3</span></a>. This applies summary functions to an entire table (or groups, as you’ll see in the next section).</p>
<p>Let’s say we want to determine the mean velocity, plus the minimum and maximum velocity, for any starting block position, block angle, and year. First, we need to reshape the data like we learned in <a href="08-tidy.html" class="quarto-xref"><span>Chapter 8</span></a>, so that there is a column for year and one column for velocity, instead of separate columns for each year. We’ll also drop the satisfaction data as we don’t need it for this analysis.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1"></a>velocity4 <span class="ot">&lt;-</span> velocity <span class="sc">%&gt;%</span></span>
<span id="cb18-2"><a href="#cb18-2"></a>  <span class="fu">select</span>(<span class="sc">-</span>satisfaction_2022, <span class="sc">-</span>satisfaction_2023) <span class="sc">%&gt;%</span></span>
<span id="cb18-3"><a href="#cb18-3"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> velocity_2022<span class="sc">:</span>velocity_2023,</span>
<span id="cb18-4"><a href="#cb18-4"></a>               <span class="at">names_to =</span> <span class="fu">c</span>(<span class="st">"velocity"</span>, <span class="st">"year"</span>),</span>
<span id="cb18-5"><a href="#cb18-5"></a>               <span class="at">names_sep =</span> <span class="st">"_"</span>,</span>
<span id="cb18-6"><a href="#cb18-6"></a>               <span class="at">values_to =</span> <span class="st">"value"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb18-7"><a href="#cb18-7"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> velocity,</span>
<span id="cb18-8"><a href="#cb18-8"></a>              <span class="at">values_from =</span> value)</span>
<span id="cb18-9"><a href="#cb18-9"></a></span>
<span id="cb18-10"><a href="#cb18-10"></a><span class="fu">head</span>(velocity4) <span class="co"># check the format</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="kable-table">
<table class="caption-top table table-sm table-striped small">
<thead><tr class="header">
<th style="text-align: left;">position</th>
<th style="text-align: left;">angle</th>
<th style="text-align: left;">year</th>
<th style="text-align: right;">velocity</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">bunched</td>
<td style="text-align: left;">&lt;50 degrees</td>
<td style="text-align: left;">2022</td>
<td style="text-align: right;">3.03</td>
</tr>
<tr class="even">
<td style="text-align: left;">bunched</td>
<td style="text-align: left;">&lt;50 degrees</td>
<td style="text-align: left;">2023</td>
<td style="text-align: right;">3.00</td>
</tr>
<tr class="odd">
<td style="text-align: left;">bunched</td>
<td style="text-align: left;">&gt;50 degrees</td>
<td style="text-align: left;">2022</td>
<td style="text-align: right;">2.90</td>
</tr>
<tr class="even">
<td style="text-align: left;">bunched</td>
<td style="text-align: left;">&gt;50 degrees</td>
<td style="text-align: left;">2023</td>
<td style="text-align: right;">3.34</td>
</tr>
<tr class="odd">
<td style="text-align: left;">medium</td>
<td style="text-align: left;">&lt;50 degrees</td>
<td style="text-align: left;">2022</td>
<td style="text-align: right;">3.30</td>
</tr>
<tr class="even">
<td style="text-align: left;">medium</td>
<td style="text-align: left;">&lt;50 degrees</td>
<td style="text-align: left;">2023</td>
<td style="text-align: right;">3.51</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>Now we can create summary statistics for the table.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1"></a>velocity4 <span class="sc">%&gt;%</span></span>
<span id="cb19-2"><a href="#cb19-2"></a>  <span class="fu">summarise</span>(</span>
<span id="cb19-3"><a href="#cb19-3"></a>    <span class="at">mean_velocity =</span> <span class="fu">mean</span>(velocity),</span>
<span id="cb19-4"><a href="#cb19-4"></a>    <span class="at">min_velocity =</span> <span class="fu">min</span>(velocity),</span>
<span id="cb19-5"><a href="#cb19-5"></a>    <span class="at">max_velocity =</span> <span class="fu">max</span>(velocity)</span>
<span id="cb19-6"><a href="#cb19-6"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="kable-table">
<table class="caption-top table table-sm table-striped small">
<thead><tr class="header">
<th style="text-align: right;">mean_velocity</th>
<th style="text-align: right;">min_velocity</th>
<th style="text-align: right;">max_velocity</th>
</tr></thead>
<tbody><tr class="odd">
<td style="text-align: right;">3.185833</td>
<td style="text-align: right;">2.9</td>
<td style="text-align: right;">3.51</td>
</tr></tbody>
</table>
</div>
</div>
</div>
</section><section id="sec-dplyr-groupby" class="level3" data-number="9.2.6"><h3 data-number="9.2.6" class="anchored" data-anchor-id="sec-dplyr-groupby">
<span class="header-section-number">9.2.6</span> Group By</h3>
<p>You were introduced to the <code>group_by()</code> function in <a href="05-summary.html#sec-grouping" class="quarto-xref"><span>Section 5.5</span></a>. For example, you can break down the summary statistics above by year and block angle.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1"></a>year_angle <span class="ot">&lt;-</span> velocity4 <span class="sc">%&gt;%</span></span>
<span id="cb20-2"><a href="#cb20-2"></a>  <span class="fu">group_by</span>(year, angle) <span class="sc">%&gt;%</span></span>
<span id="cb20-3"><a href="#cb20-3"></a>  <span class="fu">summarise</span>(</span>
<span id="cb20-4"><a href="#cb20-4"></a>    <span class="at">mean_velocity =</span> <span class="fu">mean</span>(velocity),</span>
<span id="cb20-5"><a href="#cb20-5"></a>    <span class="at">min_velocity =</span> <span class="fu">min</span>(velocity),</span>
<span id="cb20-6"><a href="#cb20-6"></a>    <span class="at">max_velocity =</span> <span class="fu">max</span>(velocity)</span>
<span id="cb20-7"><a href="#cb20-7"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb20-8"><a href="#cb20-8"></a>  <span class="fu">ungroup</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'year'. You can override using the
`.groups` argument.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1"></a>year_angle</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="kable-table">
<table class="caption-top table table-sm table-striped small">
<thead><tr class="header">
<th style="text-align: left;">year</th>
<th style="text-align: left;">angle</th>
<th style="text-align: right;">mean_velocity</th>
<th style="text-align: right;">min_velocity</th>
<th style="text-align: right;">max_velocity</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">2022</td>
<td style="text-align: left;">&lt;50 degrees</td>
<td style="text-align: right;">3.113333</td>
<td style="text-align: right;">3.01</td>
<td style="text-align: right;">3.30</td>
</tr>
<tr class="even">
<td style="text-align: left;">2022</td>
<td style="text-align: left;">&gt;50 degrees</td>
<td style="text-align: right;">3.076667</td>
<td style="text-align: right;">2.90</td>
<td style="text-align: right;">3.30</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2023</td>
<td style="text-align: left;">&lt;50 degrees</td>
<td style="text-align: right;">3.323333</td>
<td style="text-align: right;">3.00</td>
<td style="text-align: right;">3.51</td>
</tr>
<tr class="even">
<td style="text-align: left;">2023</td>
<td style="text-align: left;">&gt;50 degrees</td>
<td style="text-align: right;">3.230000</td>
<td style="text-align: right;">3.10</td>
<td style="text-align: right;">3.34</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>Note that you can use the other wrangling functions on the summary table, for example:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1"></a><span class="co"># arrange by maximum velocity</span></span>
<span id="cb23-2"><a href="#cb23-2"></a>year_angle <span class="sc">%&gt;%</span></span>
<span id="cb23-3"><a href="#cb23-3"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(max_velocity))</span>
<span id="cb23-4"><a href="#cb23-4"></a></span>
<span id="cb23-5"><a href="#cb23-5"></a><span class="co"># filter out block angles of &gt;50 degrees</span></span>
<span id="cb23-6"><a href="#cb23-6"></a>year_angle <span class="sc">%&gt;%</span></span>
<span id="cb23-7"><a href="#cb23-7"></a>  <span class="fu">filter</span>(angle <span class="sc">!=</span> <span class="st">"&gt;50 degrees"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="try callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>How would you find out the maximum velocity for each starting block position?</p>
<div class="cell" data-layout-align="center">
<div id="radio_HHORTBPVGX" class="webex-radiogroup">
<label><input type="radio" autocomplete="off" name="radio_HHORTBPVGX" value="x"><span>
<pre>velocity3 %&gt;%
  group_by(position) %&gt;%
  summarise(max_velocity = max(position)</pre>
</span></label><label><input type="radio" autocomplete="off" name="radio_HHORTBPVGX" value="answer"><span>
<pre>velocity3 %&gt;%
  group_by(position) %&gt;%
  summarise(max_velocity = max(velocity)</pre>
</span></label><label><input type="radio" autocomplete="off" name="radio_HHORTBPVGX" value="x"><span>
<pre>velocity3 %&gt;%
  group_by(velocity) %&gt;%
  summarise(max_velocity = max(position)</pre>
</span></label><label><input type="radio" autocomplete="off" name="radio_HHORTBPVGX" value="x"><span>
<pre>velocity3 %&gt;%
  group_by(velocity) %&gt;%
  summarise(max_velocity = max(velocity)</pre>
</span></label>
</div>
</div>
</div>
</div>
<p>You can also use <code>group_by()</code> in combination with other functions. For example, <code>slice_max()</code> returns the top N rows, ordered by a specific variable.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1"></a><span class="co"># return top 3 velocities</span></span>
<span id="cb24-2"><a href="#cb24-2"></a>velocity4 <span class="sc">%&gt;%</span></span>
<span id="cb24-3"><a href="#cb24-3"></a>  <span class="fu">slice_max</span>(<span class="at">n =</span> <span class="dv">3</span>, <span class="at">order_by =</span> velocity)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="kable-table">
<table class="caption-top table table-sm table-striped small">
<thead><tr class="header">
<th style="text-align: left;">position</th>
<th style="text-align: left;">angle</th>
<th style="text-align: left;">year</th>
<th style="text-align: right;">velocity</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">medium</td>
<td style="text-align: left;">&lt;50 degrees</td>
<td style="text-align: left;">2023</td>
<td style="text-align: right;">3.51</td>
</tr>
<tr class="even">
<td style="text-align: left;">elongated</td>
<td style="text-align: left;">&lt;50 degrees</td>
<td style="text-align: left;">2023</td>
<td style="text-align: right;">3.46</td>
</tr>
<tr class="odd">
<td style="text-align: left;">bunched</td>
<td style="text-align: left;">&gt;50 degrees</td>
<td style="text-align: left;">2023</td>
<td style="text-align: right;">3.34</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>But this can be combined with <code>group_by()</code> to return the top velocity for each starting block position:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1"></a><span class="co"># return top velocity for each position</span></span>
<span id="cb25-2"><a href="#cb25-2"></a>velocity4 <span class="sc">%&gt;%</span></span>
<span id="cb25-3"><a href="#cb25-3"></a>  <span class="fu">group_by</span>(position) <span class="sc">%&gt;%</span></span>
<span id="cb25-4"><a href="#cb25-4"></a>  <span class="fu">slice_max</span>(<span class="at">n =</span> <span class="dv">1</span>, <span class="at">order_by =</span> velocity)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="kable-table">
<table class="caption-top table table-sm table-striped small">
<thead><tr class="header">
<th style="text-align: left;">position</th>
<th style="text-align: left;">angle</th>
<th style="text-align: left;">year</th>
<th style="text-align: right;">velocity</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">bunched</td>
<td style="text-align: left;">&gt;50 degrees</td>
<td style="text-align: left;">2023</td>
<td style="text-align: right;">3.34</td>
</tr>
<tr class="even">
<td style="text-align: left;">elongated</td>
<td style="text-align: left;">&lt;50 degrees</td>
<td style="text-align: left;">2023</td>
<td style="text-align: right;">3.46</td>
</tr>
<tr class="odd">
<td style="text-align: left;">medium</td>
<td style="text-align: left;">&lt;50 degrees</td>
<td style="text-align: left;">2023</td>
<td style="text-align: right;">3.51</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</section></section><section id="complications" class="level2" data-number="9.3"><h2 data-number="9.3" class="anchored" data-anchor-id="complications">
<span class="header-section-number">9.3</span> Complications</h2>
<section id="rounding" class="level3" data-number="9.3.1"><h3 data-number="9.3.1" class="anchored" data-anchor-id="rounding">
<span class="header-section-number">9.3.1</span> Rounding</h3>
<p>Let’s say we want to round all the values to zero decimal places. The pattern below uses the <code>across()</code> function to apply the <code><a href="https://rdrr.io/r/base/Round.html">round()</a></code> function to the columns from <code>mean_velocity</code> to <code>max_velocity</code>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1"></a>year_angle <span class="sc">%&gt;%</span></span>
<span id="cb26-2"><a href="#cb26-2"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="at">.cols =</span> mean_velocity<span class="sc">:</span>max_velocity, </span>
<span id="cb26-3"><a href="#cb26-3"></a>                <span class="at">.fns =</span> round))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="kable-table">
<table class="caption-top table table-sm table-striped small">
<thead><tr class="header">
<th style="text-align: left;">year</th>
<th style="text-align: left;">angle</th>
<th style="text-align: right;">mean_velocity</th>
<th style="text-align: right;">min_velocity</th>
<th style="text-align: right;">max_velocity</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">2022</td>
<td style="text-align: left;">&lt;50 degrees</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">3</td>
</tr>
<tr class="even">
<td style="text-align: left;">2022</td>
<td style="text-align: left;">&gt;50 degrees</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">3</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2023</td>
<td style="text-align: left;">&lt;50 degrees</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">4</td>
</tr>
<tr class="even">
<td style="text-align: left;">2023</td>
<td style="text-align: left;">&gt;50 degrees</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">3</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>Please note that R rounds .5 to the nearest even number, rather than always up, like you were probably taught in school. This prevents overestimation biases, since x.5 is <em>exactly</em> halfway between x and x+1, so there is no reason it should always round up.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1"></a><span class="fu">round</span>(<span class="fl">0.5</span>)</span>
<span id="cb27-2"><a href="#cb27-2"></a><span class="fu">round</span>(<span class="fl">1.5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0
[1] 2</code></pre>
</div>
</div>
<p>However, this might throw a monkey wrench into your own systems. For example, a school policy might be to round up for course marks at x.5. The solution is to define your own version of <code><a href="https://rdrr.io/r/base/Round.html">round()</a></code> (modified from <a href="http://andrewlandgraf.com/2012/06/15/rounding-in-r/" target="_blank">Andrew Landgraf’s blog</a>). Put it in a hidden code block at the top of your script, with a clear warning that this is changing the way <code><a href="https://rdrr.io/r/base/Round.html">round()</a></code> normally works. You don’t need to understand how this function works, just how to use it.</p>
<p>when you run this code, a new section will appear in the environment pane labelled “Functions”. In addition to using functions from packages, you can also make your own. It’s not something we are going to go into detail on in this course, but it’s useful to know the functionality exists.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1"></a><span class="co">#!!!!!! redefining round so 5s round up !!!!!! </span></span>
<span id="cb29-2"><a href="#cb29-2"></a>round <span class="ot">&lt;-</span> <span class="cf">function</span>(x, <span class="at">digits =</span> <span class="dv">0</span>) {</span>
<span id="cb29-3"><a href="#cb29-3"></a>  posneg <span class="ot">=</span> <span class="fu">sign</span>(x)</span>
<span id="cb29-4"><a href="#cb29-4"></a>  z <span class="ot">=</span> <span class="fu">abs</span>(x)<span class="sc">*</span><span class="dv">10</span><span class="sc">^</span>digits</span>
<span id="cb29-5"><a href="#cb29-5"></a>  z <span class="ot">=</span> z <span class="sc">+</span> <span class="fl">0.5</span> <span class="sc">+</span> <span class="fu">sqrt</span>(.Machine<span class="sc">$</span>double.eps)</span>
<span id="cb29-6"><a href="#cb29-6"></a>  z <span class="ot">=</span> <span class="fu">trunc</span>(z)</span>
<span id="cb29-7"><a href="#cb29-7"></a>  z <span class="ot">=</span> z<span class="sc">/</span><span class="dv">10</span><span class="sc">^</span>digits</span>
<span id="cb29-8"><a href="#cb29-8"></a>  z<span class="sc">*</span>posneg</span>
<span id="cb29-9"><a href="#cb29-9"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now <code><a href="https://rdrr.io/r/base/Round.html">round()</a></code> should work as you’d expect.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1"></a><span class="fu">round</span>(<span class="fl">0.5</span>)</span>
<span id="cb30-2"><a href="#cb30-2"></a><span class="fu">round</span>(<span class="fl">1.5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1
[1] 2</code></pre>
</div>
</div>
<p>Just remove your version if you want R to go back to the original method. Remember that you have to define the new round method in any script that uses it, and run the definition code before you use it interactively. You can check your Environment pane to see whether <code>round</code> is listed under “Functions”.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1"></a><span class="co"># remove new round() method</span></span>
<span id="cb32-2"><a href="#cb32-2"></a><span class="fu">rm</span>(round)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="sec-missing-values" class="level3" data-number="9.3.2"><h3 data-number="9.3.2" class="anchored" data-anchor-id="sec-missing-values">
<span class="header-section-number">9.3.2</span> Missing values</h3>
<p>If you have control over your data, it is always best to keep missing values as empty cells rather than denoting missingness with a word or implausible number. If you used “missing” rather than leaving the cell empty, the entire variable would be read as character data, which means you wouldn’t be able to perform mathematical operations like calculating the mean. If you use an implausible number (0 or 999 are common), then you risk these values being included in any calculations as real numbers.</p>
<p>However, we often don’t have control over how the data come to us, so let’s run through how to fix this.</p>
<section id="bad-missing-values" class="level4"><h4 class="anchored" data-anchor-id="bad-missing-values">Bad missing values</h4>
<p>What if the coach hadn’t returned the data on the sprinter’s bunched starting block position velocity (entered as 0), and hadn’t yet timed the sprinter’s medium starting block position velocity for 2023, so someone entered it as “missing”? We’re going to show you two functions that you can use to recode or change values, <code><a href="https://rdrr.io/r/base/ifelse.html">ifelse()</a></code> and <code>case_when()</code>. <code><a href="https://rdrr.io/r/base/ifelse.html">ifelse()</a></code> is from Base R and can be slightly more intuitive to use initially. <code>case_when()</code> is from the <pkg>dplyr</pkg> and allows you to specify multiple criteria, although is slightly more difficult to use so it’s good to be aware of both.</p>
<p>First, we’re going to recode the data to add in the missing values</p>
<p>For the bunched starting block position data, we can use <code><a href="https://rdrr.io/r/base/ifelse.html">ifelse()</a></code> to set the value of velocity to 0 if the year is 2023 and position is “bunched”, otherwise use the value from the velocity column (i.e., don’t change).</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1"></a>missing_bad <span class="ot">&lt;-</span> velocity4 <span class="sc">%&gt;%</span></span>
<span id="cb33-2"><a href="#cb33-2"></a>  <span class="fu">mutate</span>(<span class="at">velocity =</span> <span class="fu">ifelse</span>(</span>
<span id="cb33-3"><a href="#cb33-3"></a>    <span class="at">test =</span> year <span class="sc">==</span> <span class="dv">2023</span> <span class="sc">&amp;</span> position <span class="sc">==</span> <span class="st">"bunched"</span>, </span>
<span id="cb33-4"><a href="#cb33-4"></a>    <span class="at">yes =</span> <span class="dv">0</span>, <span class="co"># value if above conditions are met</span></span>
<span id="cb33-5"><a href="#cb33-5"></a>    <span class="at">no =</span> velocity <span class="co"># value if above conditions are not met</span></span>
<span id="cb33-6"><a href="#cb33-6"></a>  ))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Alternatively, we can use <code>case_when()</code> to convert the velocities for 2023 to <code>0</code>. The last line of <code>TRUE ~ velocity</code> means that the default value is retrieved from the velocity column, if none of the previous criteria applied.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1"></a>missing_bad <span class="ot">&lt;-</span> velocity4 <span class="sc">%&gt;%</span></span>
<span id="cb34-2"><a href="#cb34-2"></a>  <span class="fu">mutate</span>(<span class="at">velocity =</span> <span class="fu">case_when</span>(</span>
<span id="cb34-3"><a href="#cb34-3"></a>    <span class="co"># set to 0 when year is 2023 and position is bunched</span></span>
<span id="cb34-4"><a href="#cb34-4"></a>    year <span class="sc">==</span> <span class="dv">2023</span> <span class="sc">&amp;</span> position <span class="sc">==</span> <span class="st">"bunched"</span> <span class="sc">~</span> <span class="dv">0</span>, </span>
<span id="cb34-5"><a href="#cb34-5"></a>    <span class="co"># otherwise, set to the value in the velocity column</span></span>
<span id="cb34-6"><a href="#cb34-6"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> velocity   </span>
<span id="cb34-7"><a href="#cb34-7"></a>  ))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="webex-solution">
<button>
Using case_when() for multiple criteria
</button>
<p>The <code>case_when()</code> function allows allows you to set multiple criteria, although we’re only using one non-default criterion here. It can be very useful, but takes a little practice.</p>
<p>The example below creates a label for each row. Notice how the label for the first row is “x &lt; 2”, even though this row also fits the second criterion “y &lt; 4”. This is because <code>case_when()</code> applies the first match to each row, even if other criteria in the function also match that row.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1"></a>data <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb35-2"><a href="#cb35-2"></a>  <span class="at">x =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>,</span>
<span id="cb35-3"><a href="#cb35-3"></a>  <span class="at">y =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span></span>
<span id="cb35-4"><a href="#cb35-4"></a>)</span>
<span id="cb35-5"><a href="#cb35-5"></a></span>
<span id="cb35-6"><a href="#cb35-6"></a>data <span class="sc">%&gt;%</span></span>
<span id="cb35-7"><a href="#cb35-7"></a>  <span class="fu">mutate</span>(<span class="at">label =</span> <span class="fu">case_when</span>(</span>
<span id="cb35-8"><a href="#cb35-8"></a>    x <span class="sc">&lt;</span> <span class="dv">2</span>           <span class="sc">~</span> <span class="st">"x &lt; 2"</span>,</span>
<span id="cb35-9"><a href="#cb35-9"></a>    y <span class="sc">&lt;</span> <span class="dv">4</span>           <span class="sc">~</span> <span class="st">"y &lt; 4"</span>,</span>
<span id="cb35-10"><a href="#cb35-10"></a>    x <span class="sc">==</span> <span class="dv">5</span> <span class="sc">&amp;</span> y <span class="sc">==</span> <span class="dv">5</span> <span class="sc">~</span> <span class="st">"both 5"</span>,</span>
<span id="cb35-11"><a href="#cb35-11"></a>    <span class="cn">TRUE</span>            <span class="sc">~</span> <span class="st">"default"</span></span>
<span id="cb35-12"><a href="#cb35-12"></a>  ))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="kable-table">
<table class="caption-top table table-sm table-striped small">
<thead><tr class="header">
<th style="text-align: right;">x</th>
<th style="text-align: right;">y</th>
<th style="text-align: left;">label</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">x &lt; 2</td>
</tr>
<tr class="even">
<td style="text-align: right;">2</td>
<td style="text-align: right;">2</td>
<td style="text-align: left;">y &lt; 4</td>
</tr>
<tr class="odd">
<td style="text-align: right;">3</td>
<td style="text-align: right;">3</td>
<td style="text-align: left;">y &lt; 4</td>
</tr>
<tr class="even">
<td style="text-align: right;">4</td>
<td style="text-align: right;">4</td>
<td style="text-align: left;">default</td>
</tr>
<tr class="odd">
<td style="text-align: right;">5</td>
<td style="text-align: right;">5</td>
<td style="text-align: left;">both 5</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<p>For the medium starting block position, we need to recode these values as “missing”. Since this is character data, and velocities are numeric data, the result will be <a href="https://psyteachr.github.io/glossary/c#coercion" target="_blank" class="glossary" title="Changing the data type of values in a vector to a single compatible type.">coerced</a> to a character.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1"></a><span class="co"># set velocity values to "missing" for medium starting block position 2023 rows</span></span>
<span id="cb36-2"><a href="#cb36-2"></a>missing_bad <span class="ot">&lt;-</span> missing_bad <span class="sc">%&gt;%</span></span>
<span id="cb36-3"><a href="#cb36-3"></a>  <span class="fu">mutate</span>(<span class="at">velocity =</span> <span class="fu">ifelse</span>(year <span class="sc">==</span> <span class="dv">2023</span> <span class="sc">&amp;</span> position <span class="sc">==</span> <span class="st">"medium"</span>, </span>
<span id="cb36-4"><a href="#cb36-4"></a>                        <span class="st">"missing"</span>, </span>
<span id="cb36-5"><a href="#cb36-5"></a>                        velocity))</span>
<span id="cb36-6"><a href="#cb36-6"></a></span>
<span id="cb36-7"><a href="#cb36-7"></a><span class="co"># check structure of data, velocity now character</span></span>
<span id="cb36-8"><a href="#cb36-8"></a><span class="fu">str</span>(missing_bad)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>tibble [12 × 4] (S3: tbl_df/tbl/data.frame)
 $ position: chr [1:12] "bunched" "bunched" "bunched" "bunched" ...
 $ angle   : chr [1:12] "&lt;50 degrees" "&lt;50 degrees" "&gt;50 degrees" "&gt;50 degrees" ...
 $ year    : chr [1:12] "2022" "2023" "2022" "2023" ...
 $ velocity: chr [1:12] "3.03" "0" "2.9" "0" ...</code></pre>
</div>
</div>
<p>If we’re using <code>case_when()</code>, first we need to convert the velocity column to a character, as this function is a little pickier and won’t let you combine <a href="https://psyteachr.github.io/glossary/d#data-type" target="_blank" class="glossary" title="The kind of data represented by an object.">data types</a>, since this almost always means that you’re making a mistake.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1"></a><span class="co"># set velocity values to "missing" for medium starting block position 2023 rows</span></span>
<span id="cb38-2"><a href="#cb38-2"></a>missing_bad <span class="ot">&lt;-</span> missing_bad <span class="sc">%&gt;%</span></span>
<span id="cb38-3"><a href="#cb38-3"></a>  <span class="fu">mutate</span>(<span class="at">velocity =</span> <span class="fu">as.character</span>(velocity),</span>
<span id="cb38-4"><a href="#cb38-4"></a>         <span class="at">velocity =</span> <span class="fu">case_when</span>(year <span class="sc">==</span> <span class="dv">2023</span> <span class="sc">&amp;</span> position <span class="sc">==</span> <span class="st">"medium"</span> <span class="sc">~</span> <span class="st">"missing"</span>, </span>
<span id="cb38-5"><a href="#cb38-5"></a>                           <span class="cn">TRUE</span> <span class="sc">~</span> velocity))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now, if you try to compute the mean velocity, you will get an error message and the result will be <code>NA</code>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1"></a><span class="co"># try to compute mean velocity</span></span>
<span id="cb39-2"><a href="#cb39-2"></a>missing_bad <span class="sc">%&gt;%</span></span>
<span id="cb39-3"><a href="#cb39-3"></a>  <span class="fu">summarise</span>(<span class="at">mean_velocity =</span> <span class="fu">mean</span>(velocity))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: There was 1 warning in `summarise()`.
ℹ In argument: `mean_velocity = mean(velocity)`.
Caused by warning in `mean.default()`:
! argument is not numeric or logical: returning NA</code></pre>
</div>
<div class="cell-output-display">
<div class="kable-table">
<table class="caption-top table table-sm table-striped small">
<thead><tr class="header">
<th style="text-align: right;">mean_velocity</th>
</tr></thead>
<tbody><tr class="odd">
<td style="text-align: right;">NA</td>
</tr></tbody>
</table>
</div>
</div>
</div>
</section><section id="convert-missing-values-to-na" class="level4"><h4 class="anchored" data-anchor-id="convert-missing-values-to-na">Convert missing values to NA</h4>
<p>To set the missing values to NA, you could use either <code><a href="https://rdrr.io/r/base/ifelse.html">ifelse()</a></code> or <code>case_when()</code>. Because the <code>velocity</code> column was converted to character, we also need to transform this back to numeric.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1"></a>missing_data <span class="ot">&lt;-</span> missing_bad <span class="sc">%&gt;%</span></span>
<span id="cb41-2"><a href="#cb41-2"></a>  <span class="fu">mutate</span>(</span>
<span id="cb41-3"><a href="#cb41-3"></a>    <span class="co"># set "0" values to NA using ifelse</span></span>
<span id="cb41-4"><a href="#cb41-4"></a>    <span class="at">velocity =</span> <span class="fu">ifelse</span>(velocity <span class="sc">==</span> <span class="dv">0</span>, <span class="cn">NA</span>, velocity),</span>
<span id="cb41-5"><a href="#cb41-5"></a>    <span class="co"># set "missing" values to NA using case_when</span></span>
<span id="cb41-6"><a href="#cb41-6"></a>    <span class="at">velocity =</span> <span class="fu">case_when</span>(velocity <span class="sc">==</span> <span class="st">"missing"</span> <span class="sc">~</span> <span class="cn">NA_character_</span>,</span>
<span id="cb41-7"><a href="#cb41-7"></a>                      <span class="cn">TRUE</span> <span class="sc">~</span> velocity),</span>
<span id="cb41-8"><a href="#cb41-8"></a>    <span class="co"># convert to numeric</span></span>
<span id="cb41-9"><a href="#cb41-9"></a>    <span class="at">velocity =</span> <span class="fu">as.numeric</span>(velocity)</span>
<span id="cb41-10"><a href="#cb41-10"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Because <code>case_when()</code> is so picky about character types, you need to specify which type of NA you’re using (there is a specific NA for each data type).</p>
<p>Technically, <code>NA</code> has a <a href="https://psyteachr.github.io/glossary/l#logical" target="_blank" class="glossary" title="A data type representing TRUE or FALSE values.">logical</a> data type, so functions that aren’t as picky about combining data types will <a href="https://psyteachr.github.io/glossary/c#coercion" target="_blank" class="glossary" title="Changing the data type of values in a vector to a single compatible type.">coerce</a> this to the NA version for the most compatible data type.</p>
<p>Now, if we try to calculate the mean velocity, we get missing values for any summary value that used one of the bunched or medium starting block position 2023 velocity values.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1"></a>missing_data <span class="sc">%&gt;%</span></span>
<span id="cb42-2"><a href="#cb42-2"></a>  <span class="fu">group_by</span>(position) <span class="sc">%&gt;%</span></span>
<span id="cb42-3"><a href="#cb42-3"></a>  <span class="fu">summarise</span>(</span>
<span id="cb42-4"><a href="#cb42-4"></a>    <span class="at">mean_velocity =</span> <span class="fu">mean</span>(velocity),</span>
<span id="cb42-5"><a href="#cb42-5"></a>    <span class="at">min_velocity =</span> <span class="fu">min</span>(velocity),</span>
<span id="cb42-6"><a href="#cb42-6"></a>    <span class="at">max_velocity =</span> <span class="fu">max</span>(velocity),</span>
<span id="cb42-7"><a href="#cb42-7"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="kable-table">
<table class="caption-top table table-sm table-striped small">
<thead><tr class="header">
<th style="text-align: left;">position</th>
<th style="text-align: right;">mean_velocity</th>
<th style="text-align: right;">min_velocity</th>
<th style="text-align: right;">max_velocity</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">bunched</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="even">
<td style="text-align: left;">elongated</td>
<td style="text-align: right;">3.255</td>
<td style="text-align: right;">3.01</td>
<td style="text-align: right;">3.46</td>
</tr>
<tr class="odd">
<td style="text-align: left;">medium</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</section><section id="ignore-missing-values" class="level4"><h4 class="anchored" data-anchor-id="ignore-missing-values">Ignore missing values</h4>
<p>This is because <code>NA</code> basically means “I don’t know”, and the sum of 100 and “I don’t know” is “I don’t know”, not 100. However, when you’re calculating means, you often want to just ignore missing values. Set <code>na.rm = TRUE</code> in the summary function to remove missing values before calculating.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1"></a>missing_data <span class="sc">%&gt;%</span></span>
<span id="cb43-2"><a href="#cb43-2"></a>  <span class="fu">group_by</span>(position) <span class="sc">%&gt;%</span></span>
<span id="cb43-3"><a href="#cb43-3"></a>  <span class="fu">summarise</span>(</span>
<span id="cb43-4"><a href="#cb43-4"></a>    <span class="at">mean_velocity =</span> <span class="fu">mean</span>(velocity, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb43-5"><a href="#cb43-5"></a>    <span class="at">min_velocity =</span> <span class="fu">min</span>(velocity, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb43-6"><a href="#cb43-6"></a>    <span class="at">max_velocity =</span> <span class="fu">max</span>(velocity, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb43-7"><a href="#cb43-7"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb43-8"><a href="#cb43-8"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="kable-table">
<table class="caption-top table table-sm table-striped small">
<thead><tr class="header">
<th style="text-align: left;">position</th>
<th style="text-align: right;">mean_velocity</th>
<th style="text-align: right;">min_velocity</th>
<th style="text-align: right;">max_velocity</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">bunched</td>
<td style="text-align: right;">2.965</td>
<td style="text-align: right;">2.90</td>
<td style="text-align: right;">3.03</td>
</tr>
<tr class="even">
<td style="text-align: left;">elongated</td>
<td style="text-align: right;">3.255</td>
<td style="text-align: right;">3.01</td>
<td style="text-align: right;">3.46</td>
</tr>
<tr class="odd">
<td style="text-align: left;">medium</td>
<td style="text-align: right;">3.165</td>
<td style="text-align: right;">3.03</td>
<td style="text-align: right;">3.30</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</section><section id="count-missing-values" class="level4"><h4 class="anchored" data-anchor-id="count-missing-values">Count missing values</h4>
<p>If you want to find out how many missing or non-missing values there are in a column, use the <code><a href="https://rdrr.io/r/base/NA.html">is.na()</a></code> function to get a <a href="https://psyteachr.github.io/glossary/l#logical" target="_blank" class="glossary" title="A data type representing TRUE or FALSE values.">logical</a> vector of whether or not each value is missing, and use <code><a href="https://rdrr.io/r/base/sum.html">sum()</a></code> to count how many values are TRUE or <code><a href="https://rdrr.io/r/base/mean.html">mean()</a></code> to calculate the proportion of TRUE values.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1"></a>missing_data <span class="sc">%&gt;%</span></span>
<span id="cb44-2"><a href="#cb44-2"></a>  <span class="fu">group_by</span>(year, angle) <span class="sc">%&gt;%</span></span>
<span id="cb44-3"><a href="#cb44-3"></a>  <span class="fu">summarise</span>(</span>
<span id="cb44-4"><a href="#cb44-4"></a>    <span class="at">n_valid =</span> <span class="fu">sum</span>(<span class="sc">!</span><span class="fu">is.na</span>(velocity)),</span>
<span id="cb44-5"><a href="#cb44-5"></a>    <span class="at">n_missing =</span> <span class="fu">sum</span>(<span class="fu">is.na</span>(velocity)),</span>
<span id="cb44-6"><a href="#cb44-6"></a>    <span class="at">prop_missing =</span> <span class="fu">mean</span>(<span class="fu">is.na</span>(velocity)),</span>
<span id="cb44-7"><a href="#cb44-7"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb44-8"><a href="#cb44-8"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="kable-table">
<table class="caption-top table table-sm table-striped small">
<thead><tr class="header">
<th style="text-align: left;">year</th>
<th style="text-align: left;">angle</th>
<th style="text-align: right;">n_valid</th>
<th style="text-align: right;">n_missing</th>
<th style="text-align: right;">prop_missing</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">2022</td>
<td style="text-align: left;">&lt;50 degrees</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.0000000</td>
</tr>
<tr class="even">
<td style="text-align: left;">2022</td>
<td style="text-align: left;">&gt;50 degrees</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.0000000</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2023</td>
<td style="text-align: left;">&lt;50 degrees</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">0.6666667</td>
</tr>
<tr class="even">
<td style="text-align: left;">2023</td>
<td style="text-align: left;">&gt;50 degrees</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">0.6666667</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</section><section id="omit-missing-values" class="level4"><h4 class="anchored" data-anchor-id="omit-missing-values">Omit missing values</h4>
<p>You may also want to remove rows that have missing values and only work from complete datasets. <code>drop_na()</code> will remove any row that has a missing observation. You can use <code>drop_na()</code> on the entire dataset which will remove any row that has <em>any</em> missing value, or you can specify to only remove rows that are missing a specific value.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1"></a><span class="co"># remove any rows with any missing values</span></span>
<span id="cb45-2"><a href="#cb45-2"></a>complete_data <span class="ot">&lt;-</span> missing_data <span class="sc">%&gt;%</span></span>
<span id="cb45-3"><a href="#cb45-3"></a>  <span class="fu">drop_na</span>()</span>
<span id="cb45-4"><a href="#cb45-4"></a></span>
<span id="cb45-5"><a href="#cb45-5"></a><span class="co"># remove any rows that are missing a value for velocity</span></span>
<span id="cb45-6"><a href="#cb45-6"></a>complete_velocity <span class="ot">&lt;-</span> missing_data <span class="sc">%&gt;%</span></span>
<span id="cb45-7"><a href="#cb45-7"></a>  <span class="fu">drop_na</span>(velocity)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Missing data can be quite difficult to deal with depending on how it is represented. As always, no amount of coding expertise can make up for not understanding the structure and idiosyncrasies of your data.</p>
</section></section></section><section id="sec-together-wrangle" class="level2" data-number="9.4"><h2 data-number="9.4" class="anchored" data-anchor-id="sec-together-wrangle">
<span class="header-section-number">9.4</span> Exercises</h2>
<p>Let’s try some exercises using a dataset you already encountered in <a href="03-viz.html" class="quarto-xref"><span>Chapter 3</span></a> so that you can see how much more you’re able to do with the data now.</p>
<ul>
<li>Save your current Markdown, close it, and open a new Rmd named “function_data_mad_skillz”.</li>
<li>In the set-up code chunk, load the tidyverse, then load the dataset from https://healthteachr.github.io/data/Function_and_PA_data into an object named <code>function_data</code>.</li>
<li>Use your method of choice to review the dataset and familiarise yourself with its structure.</li>
</ul>
<div class="cell" data-layout-align="center" data-webex.hide="true">
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-8-contents" aria-controls="callout-8" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Solution
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-8" class="callout-8-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb46-2"><a href="#cb46-2"></a>function_data <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"https://healthteachr.github.io/data/Function_and_PA_data.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Rows: 100 Columns: 10
── Column specification ────────────────────────────────────────────────────────
Delimiter: ","
chr  (3): sex, musculoskeletal, condition_type
dbl  (6): id, CASP19, gaitspeed, age, steps, generalhealth
dttm (1): test_start

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
</div>
</div>
</div>
</div>
<section id="creating-new-categories" class="level3" data-number="9.4.1"><h3 data-number="9.4.1" class="anchored" data-anchor-id="creating-new-categories">
<span class="header-section-number">9.4.1</span> Creating new categories</h3>
<p>Participants with musculoskeletal conditions affecting the joints, bones, or muscles were hospitalised in the last year and participants with no musculoskeletal conditions were not hospitalised in the last year.</p>
<ul>
<li>Create a new column named <code>hospitalised</code> that lists whether the participant was admitted to hospital in the last year.</li>
<li>Then, calculate the average quality-of-life (CASP19) scores for participants who had and had not been hospitalised in the last year, and visualise the quality-of-life scores for each group in whatever way you think best.</li>
</ul>
<p><code>r hide("Hint")</code> To add the hospitalised column you can either use <code>case_when()</code> and specify multiple criteria (e.g., if the participant’s condition affects the joints, bones, or muscles, hospitalised, if the participant’s condition type is “None”, not hospitalised), or you could use <code><a href="https://rdrr.io/r/base/ifelse.html">ifelse()</a></code> and set the <code>test</code> to participants who were hospitalised and return <code>not hospitalised</code> for all others. <code>r unhide()</code></p>
<div class="cell" data-layout-align="center" data-webex.hide="true">
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-9-contents" aria-controls="callout-9" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Solution
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-9" class="callout-9-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1"></a><span class="co"># case_when() method</span></span>
<span id="cb48-2"><a href="#cb48-2"></a>function_data <span class="ot">&lt;-</span> function_data <span class="sc">%&gt;%</span></span>
<span id="cb48-3"><a href="#cb48-3"></a>  <span class="fu">mutate</span>(<span class="at">hospitalised =</span> <span class="fu">case_when</span>(condition_type <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Joints"</span>, <span class="st">"Bones"</span>, <span class="st">"Muscles"</span>) <span class="sc">~</span> <span class="st">"hospitalised"</span>,</span>
<span id="cb48-4"><a href="#cb48-4"></a>                             condition_type <span class="sc">==</span> <span class="st">"None"</span> <span class="sc">~</span> <span class="st">"not hospitalised"</span>))</span>
<span id="cb48-5"><a href="#cb48-5"></a></span>
<span id="cb48-6"><a href="#cb48-6"></a><span class="co"># ifelse() method</span></span>
<span id="cb48-7"><a href="#cb48-7"></a></span>
<span id="cb48-8"><a href="#cb48-8"></a>function_data <span class="ot">&lt;-</span> function_data <span class="sc">%&gt;%</span></span>
<span id="cb48-9"><a href="#cb48-9"></a>  <span class="fu">mutate</span>(<span class="at">hospitalised =</span> <span class="fu">ifelse</span>(<span class="at">test =</span> condition_type <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Joints"</span>, <span class="st">"Bones"</span>, <span class="st">"Muscles"</span>),</span>
<span id="cb48-10"><a href="#cb48-10"></a>                           <span class="at">yes =</span> <span class="st">"hospitalised"</span>,</span>
<span id="cb48-11"><a href="#cb48-11"></a>                           <span class="at">no =</span> <span class="st">"not hospitalised"</span>))</span>
<span id="cb48-12"><a href="#cb48-12"></a></span>
<span id="cb48-13"><a href="#cb48-13"></a><span class="co"># mean quality-of-life scores</span></span>
<span id="cb48-14"><a href="#cb48-14"></a>function_data <span class="sc">%&gt;%</span></span>
<span id="cb48-15"><a href="#cb48-15"></a>  <span class="fu">group_by</span>(hospitalised) <span class="sc">%&gt;%</span></span>
<span id="cb48-16"><a href="#cb48-16"></a>  <span class="fu">summarise</span>(<span class="at">mean_QoL =</span> <span class="fu">mean</span>(CASP19))</span>
<span id="cb48-17"><a href="#cb48-17"></a></span>
<span id="cb48-18"><a href="#cb48-18"></a><span class="co"># possible visualisation </span></span>
<span id="cb48-19"><a href="#cb48-19"></a></span>
<span id="cb48-20"><a href="#cb48-20"></a><span class="fu">ggplot</span>(function_data, <span class="fu">aes</span>(<span class="at">x =</span> CASP19, <span class="at">fill =</span> hospitalised)) <span class="sc">+</span></span>
<span id="cb48-21"><a href="#cb48-21"></a>  <span class="fu">geom_histogram</span>(<span class="at">binwidth =</span> <span class="dv">1</span>, <span class="at">show.legend =</span> <span class="cn">FALSE</span>, <span class="at">colour =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb48-22"><a href="#cb48-22"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>hospitalised) <span class="sc">+</span></span>
<span id="cb48-23"><a href="#cb48-23"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Quality-of-life scores by hospital admission"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="09-wrangle_files/figure-html/unnamed-chunk-37-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div class="kable-table">
<table class="caption-top table table-sm table-striped small">
<thead><tr class="header">
<th style="text-align: left;">hospitalised</th>
<th style="text-align: right;">mean_QoL</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">hospitalised</td>
<td style="text-align: right;">27.00000</td>
</tr>
<tr class="even">
<td style="text-align: left;">not hospitalised</td>
<td style="text-align: right;">26.68571</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
</div>
</div>
</section><section id="filter-by-calculated-score" class="level3" data-number="9.4.2"><h3 data-number="9.4.2" class="anchored" data-anchor-id="filter-by-calculated-score">
<span class="header-section-number">9.4.2</span> Filter by calculated score</h3>
<p>First, calculate the average gait speed in m/s and store this in an object named <code>mean_speed</code>. This should be a single value rather than a table.</p>
<div class="webex-solution">
<button>
Hint
</button>
<p>There are multiple ways to achieve this. You could create the table and then pull out the single value, or just calculate the single value.</p>
</div>
<div class="cell" data-layout-align="center" data-webex.hide="true">
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-10-contents" aria-controls="callout-10" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Solution
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-10" class="callout-10-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1"></a><span class="co"># method 1 - tidyverse</span></span>
<span id="cb49-2"><a href="#cb49-2"></a>mean_speed <span class="ot">&lt;-</span> function_data <span class="sc">%&gt;%</span></span>
<span id="cb49-3"><a href="#cb49-3"></a>  <span class="fu">summarise</span>(<span class="at">mean_speed =</span> <span class="fu">mean</span>(gaitspeed)) <span class="sc">%&gt;%</span></span>
<span id="cb49-4"><a href="#cb49-4"></a>  <span class="fu">pull</span>(mean_speed)</span>
<span id="cb49-5"><a href="#cb49-5"></a></span>
<span id="cb49-6"><a href="#cb49-6"></a><span class="co"># method 2 - base R</span></span>
<span id="cb49-7"><a href="#cb49-7"></a>mean_speed <span class="ot">&lt;-</span> <span class="fu">mean</span>(function_data<span class="sc">$</span>gaitspeed)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
<p>Now create a dataset named <code>fast_speed</code> that just contains data from participants whose gait speed was above the sample’s average.</p>
<div class="cell" data-layout-align="center" data-webex.hide="true">
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-11-contents" aria-controls="callout-11" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Solution
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-11" class="callout-11-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1"></a>fast_speed <span class="ot">&lt;-</span> function_data <span class="sc">%&gt;%</span></span>
<span id="cb50-2"><a href="#cb50-2"></a>  <span class="fu">filter</span>(gaitspeed <span class="sc">&gt;</span> mean_speed)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
<p>Create a visualisation that shows how many participants had a gait speed above the sample average for each condition type.</p>
<div class="cell" data-layout-align="center" data-webex.hide="true">
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-12-contents" aria-controls="callout-12" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Solution
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-12" class="callout-12-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1"></a>fast_speed <span class="sc">%&gt;%</span></span>
<span id="cb51-2"><a href="#cb51-2"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> condition_type)) <span class="sc">+</span></span>
<span id="cb51-3"><a href="#cb51-3"></a>  <span class="fu">geom_bar</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="09-wrangle_files/figure-html/unnamed-chunk-40-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</div>
</section><section id="multiple-critera" class="level3" data-number="9.4.3"><h3 data-number="9.4.3" class="anchored" data-anchor-id="multiple-critera">
<span class="header-section-number">9.4.3</span> Multiple critera</h3>
<p>Now, add a column to <code>function_data</code> named <code>follow_up</code> that flags whether a participant should be followed up with a health check. The hospital is short-staffed so only participants that meet all three of the following criteria should be followed-up:</p>
<ul>
<li>Their gait speed should be below the average <strong>for all participants</strong>
</li>
<li>Their step count should be below the average <strong>for their musculoskeletal disease</strong>
</li>
<li>Their quality-of-life score should be less than 30.</li>
</ul>
<p>This is quite complicated and there are multiple ways to achieve the desired outcome. Some approaches may need other functions that were covered in previous chapters and you may need to create intermediate objects.</p>
<p>Call the final object <code>follow_data</code> and keep only the participant ID, condition type, hospital admission, and follow up columns.</p>
<div class="cell" data-layout-align="center" data-webex.hide="true">
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-13-contents" aria-controls="callout-13" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Solution
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-13" class="callout-13-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1"></a><span class="co"># this is one possible solution, there are many other valid approaches </span></span>
<span id="cb52-2"><a href="#cb52-2"></a></span>
<span id="cb52-3"><a href="#cb52-3"></a><span class="co"># calculate mean gait speed across all participants</span></span>
<span id="cb52-4"><a href="#cb52-4"></a>mean_speed <span class="ot">&lt;-</span> <span class="fu">mean</span>(function_data<span class="sc">$</span>gaitspeed)</span>
<span id="cb52-5"><a href="#cb52-5"></a></span>
<span id="cb52-6"><a href="#cb52-6"></a><span class="co"># calculate mean steps for each type of musculoskeletal disease</span></span>
<span id="cb52-7"><a href="#cb52-7"></a>follow_data <span class="ot">&lt;-</span> function_data <span class="sc">%&gt;%</span></span>
<span id="cb52-8"><a href="#cb52-8"></a>  <span class="fu">group_by</span>(musculoskeletal) <span class="sc">%&gt;%</span></span>
<span id="cb52-9"><a href="#cb52-9"></a>  <span class="fu">summarise</span>(<span class="at">mean_steps =</span> <span class="fu">mean</span>(steps)) <span class="sc">%&gt;%</span></span>
<span id="cb52-10"><a href="#cb52-10"></a><span class="co">#then join it to the function data  </span></span>
<span id="cb52-11"><a href="#cb52-11"></a>  <span class="fu">left_join</span>(function_data, <span class="at">by =</span> <span class="st">"musculoskeletal"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb52-12"><a href="#cb52-12"></a><span class="co"># then add on the column</span></span>
<span id="cb52-13"><a href="#cb52-13"></a>  <span class="fu">mutate</span>(<span class="at">follow_up =</span> <span class="fu">case_when</span>(gaitspeed <span class="sc">&lt;</span> mean_speed <span class="sc">&amp;</span> </span>
<span id="cb52-14"><a href="#cb52-14"></a>                               steps <span class="sc">&lt;</span> mean_steps <span class="sc">&amp;</span> </span>
<span id="cb52-15"><a href="#cb52-15"></a>                               CASP19 <span class="sc">&lt;</span> <span class="dv">30</span> <span class="sc">~</span> <span class="st">"yes"</span>,</span>
<span id="cb52-16"><a href="#cb52-16"></a>                               <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"no"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb52-17"><a href="#cb52-17"></a>  <span class="fu">select</span>(id, condition_type, hospitalised, follow_up)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
<p>For all of the above, write code that stores the answer as a single value, so that you could easily use it in inline coding.</p>
<p>How many participants need to be followed up:</p>
<ul>
<li>In total? <input class="webex-solveme nospaces" size="2" data-answer="[&quot;17&quot;]">
</li>
<li>From participants with a condition affecting the bones? <input class="webex-solveme nospaces" size="1" data-answer="[&quot;4&quot;]">
</li>
<li>From participants who were hospitalised in the last year <input class="webex-solveme nospaces" size="2" data-answer="[&quot;15&quot;]">
</li>
<li>From participants who were not hospitalised in the last year <input class="webex-solveme nospaces" size="1" data-answer="[&quot;2&quot;]">
</li>
</ul>
<div class="webex-solution">
<button>
Hint
</button>
<p>`group_by %&gt;% count() %&gt;% filter() %&gt;% pull()</p>
</div>
<p>Which condition type has the largest number of participants needing follow-up health checks? <input class="webex-solveme nospaces" size="6" data-answer="[&quot;Joints&quot;]"></p>
<div class="webex-solution">
<button>
Hint
</button>
<p>As above but add in an <code>ungroup()</code> and <code>slice_max()</code> along the way.</p>
</div>
<div class="cell" data-layout-align="center" data-webex.hide="true">
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-14-contents" aria-controls="callout-14" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Solution
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-14" class="callout-14-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1"></a><span class="co"># in total</span></span>
<span id="cb53-2"><a href="#cb53-2"></a>follow_data <span class="sc">%&gt;%</span></span>
<span id="cb53-3"><a href="#cb53-3"></a>  <span class="fu">group_by</span>(follow_up) <span class="sc">%&gt;%</span></span>
<span id="cb53-4"><a href="#cb53-4"></a>  <span class="fu">count</span>()<span class="sc">%&gt;%</span></span>
<span id="cb53-5"><a href="#cb53-5"></a>  <span class="fu">filter</span>(follow_up <span class="sc">==</span> <span class="st">"yes"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb53-6"><a href="#cb53-6"></a>  <span class="fu">pull</span>(n)</span>
<span id="cb53-7"><a href="#cb53-7"></a></span>
<span id="cb53-8"><a href="#cb53-8"></a><span class="co"># with a condition affecting the bones</span></span>
<span id="cb53-9"><a href="#cb53-9"></a>follow_data <span class="sc">%&gt;%</span></span>
<span id="cb53-10"><a href="#cb53-10"></a>  <span class="fu">group_by</span>(follow_up, condition_type) <span class="sc">%&gt;%</span></span>
<span id="cb53-11"><a href="#cb53-11"></a>  <span class="fu">count</span>() <span class="sc">%&gt;%</span></span>
<span id="cb53-12"><a href="#cb53-12"></a>  <span class="fu">filter</span>(condition_type <span class="sc">==</span> <span class="st">"Bones"</span>,</span>
<span id="cb53-13"><a href="#cb53-13"></a>         follow_up <span class="sc">==</span> <span class="st">"yes"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb53-14"><a href="#cb53-14"></a>  <span class="fu">pull</span>(n)</span>
<span id="cb53-15"><a href="#cb53-15"></a></span>
<span id="cb53-16"><a href="#cb53-16"></a><span class="co"># who were hospitalised in the last year</span></span>
<span id="cb53-17"><a href="#cb53-17"></a>follow_data <span class="sc">%&gt;%</span></span>
<span id="cb53-18"><a href="#cb53-18"></a>  <span class="fu">group_by</span>(follow_up, hospitalised) <span class="sc">%&gt;%</span></span>
<span id="cb53-19"><a href="#cb53-19"></a>  <span class="fu">count</span>() <span class="sc">%&gt;%</span></span>
<span id="cb53-20"><a href="#cb53-20"></a>  <span class="fu">filter</span>(hospitalised <span class="sc">==</span> <span class="st">"hospitalised"</span>,</span>
<span id="cb53-21"><a href="#cb53-21"></a>         follow_up <span class="sc">==</span> <span class="st">"yes"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb53-22"><a href="#cb53-22"></a>  <span class="fu">pull</span>(n)</span>
<span id="cb53-23"><a href="#cb53-23"></a></span>
<span id="cb53-24"><a href="#cb53-24"></a><span class="co"># who were not hospitalised in the last year</span></span>
<span id="cb53-25"><a href="#cb53-25"></a>follow_data <span class="sc">%&gt;%</span></span>
<span id="cb53-26"><a href="#cb53-26"></a>  <span class="fu">group_by</span>(follow_up, hospitalised) <span class="sc">%&gt;%</span></span>
<span id="cb53-27"><a href="#cb53-27"></a>  <span class="fu">count</span>() <span class="sc">%&gt;%</span></span>
<span id="cb53-28"><a href="#cb53-28"></a>  <span class="fu">filter</span>(hospitalised <span class="sc">==</span> <span class="st">"not hospitalised"</span>,</span>
<span id="cb53-29"><a href="#cb53-29"></a>         follow_up <span class="sc">==</span> <span class="st">"yes"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb53-30"><a href="#cb53-30"></a>  <span class="fu">pull</span>(n)</span>
<span id="cb53-31"><a href="#cb53-31"></a></span>
<span id="cb53-32"><a href="#cb53-32"></a><span class="co"># most follow-ups needed</span></span>
<span id="cb53-33"><a href="#cb53-33"></a>follow_data <span class="sc">%&gt;%</span></span>
<span id="cb53-34"><a href="#cb53-34"></a>  <span class="fu">group_by</span>(follow_up, condition_type) <span class="sc">%&gt;%</span></span>
<span id="cb53-35"><a href="#cb53-35"></a>  <span class="fu">count</span>() <span class="sc">%&gt;%</span></span>
<span id="cb53-36"><a href="#cb53-36"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb53-37"><a href="#cb53-37"></a>  <span class="fu">filter</span>(follow_up <span class="sc">==</span> <span class="st">"yes"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb53-38"><a href="#cb53-38"></a>  <span class="fu">slice_max</span>(<span class="at">n =</span> <span class="dv">1</span>, <span class="at">order_by =</span> n) <span class="sc">%&gt;%</span></span>
<span id="cb53-39"><a href="#cb53-39"></a>  <span class="fu">pull</span>(condition_type)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 17
[1] 4
[1] 15
[1] 2
[1] "Joints"</code></pre>
</div>
</div>
</div>
</div>
</div>
</section><section id="original-insight" class="level3" data-number="9.4.4"><h3 data-number="9.4.4" class="anchored" data-anchor-id="original-insight">
<span class="header-section-number">9.4.4</span> Original insight</h3>
<p>In preparation for the final summative assessment, explore the data to provide one original insight of your own.</p>
</section><section id="report" class="level3" data-number="9.4.5"><h3 data-number="9.4.5" class="anchored" data-anchor-id="report">
<span class="header-section-number">9.4.5</span> Report</h3>
<p>Compile all the above into a visually appealing reproducible report that could be used to target participants for extra care. Use inline coding to report any numbers in the text. Once you’re finished, post your Rmd and knitted html document on teams so that other learners can see your approach.</p>
</section></section><section id="sec-glossary-wrangle" class="level2" data-number="9.5"><h2 data-number="9.5" class="anchored" data-anchor-id="sec-glossary-wrangle">
<span class="header-section-number">9.5</span> Glossary</h2>
<div class="cell" data-layout-align="center">
<table class="caption-top table table-sm table-striped small">
<colgroup>
<col style="width: 13%">
<col style="width: 86%">
</colgroup>
<thead><tr class="header">
<th style="text-align: left;">term</th>
<th style="text-align: left;">definition</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">boolean expression</td>
<td style="text-align: left;">An expression that evaluates to TRUE or FALSE.</td>
</tr>
<tr class="even">
<td style="text-align: left;">coercion</td>
<td style="text-align: left;">Changing the data type of values in a vector to a single compatible type.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">data type</td>
<td style="text-align: left;">The kind of data represented by an object.</td>
</tr>
<tr class="even">
<td style="text-align: left;">data wrangling</td>
<td style="text-align: left;">The process of preparing data for visualisation and statistical analysis.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">factor</td>
<td style="text-align: left;">A data type where a specific set of values are stored with labels; An explanatory variable manipulated by the experimenter</td>
</tr>
<tr class="even">
<td style="text-align: left;">logical</td>
<td style="text-align: left;">A data type representing TRUE or FALSE values.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">match operator</td>
<td style="text-align: left;">A binary operator (%in%) that returns a logical vector indicating if there is a match or not for its left operand.</td>
</tr>
<tr class="even">
<td style="text-align: left;">Operator</td>
<td style="text-align: left;">A symbol that performs some mathematical or comparative process.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">string</td>
<td style="text-align: left;">A piece of text inside of quotes.</td>
</tr>
</tbody>
</table>
</div>
</section><section id="sec-resources-wrangle" class="level2" data-number="9.6"><h2 data-number="9.6" class="anchored" data-anchor-id="sec-resources-wrangle">
<span class="header-section-number">9.6</span> Further resources</h2>
<ul>
<li><a href="https://raw.githubusercontent.com/rstudio/cheatsheets/main/data-transformation.pdf">Data transformation cheat sheet</a></li>
<li>
<a href="http://r4ds.had.co.nz/transform.html">Chapter 5: Data Transformation</a> in <em>R for Data Science</em>
</li>
<li>
<a href="https://r4ds.had.co.nz/functions.html">Chapter 19: Functions</a> in <em>R for Data Science</em>
</li>
<li><a href="https://stringr.tidyverse.org/articles/stringr.html">Introduction to stringr</a></li>
</ul>


</section></main><!-- /main --><script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.1/jquery.min.js"></script><script>

/* update total correct if #webex-total_correct exists */
update_total_correct = function() {
  console.log("webex: update total_correct");

  if (t = document.getElementById("webex-total_correct")) {
    var correct = document.getElementsByClassName("webex-correct").length;
    var solvemes = document.getElementsByClassName("webex-solveme").length;
    var radiogroups = document.getElementsByClassName("webex-radiogroup").length;
    var selects = document.getElementsByClassName("webex-select").length;

    t.innerHTML = correct + " of " + (solvemes + radiogroups + selects) + " correct";
  }
}

/* webex-solution button toggling function */
b_func = function() {
  console.log("webex: toggle hide");

  var cl = this.parentElement.classList;
  if (cl.contains('open')) {
    cl.remove("open");
  } else {
    cl.add("open");
  }
}

/* function for checking solveme answers */
solveme_func = function(e) {
  console.log("webex: check solveme");

  var real_answers = JSON.parse(this.dataset.answer);
  var my_answer = this.value;
  var cl = this.classList;
  if (cl.contains("ignorecase")) {
    my_answer = my_answer.toLowerCase();
  }
  if (cl.contains("nospaces")) {
    my_answer = my_answer.replace(/ /g, "")
  }

  if (my_answer == "") {
    cl.remove("webex-correct");
    cl.remove("webex-incorrect");
  } else if (real_answers.includes(my_answer)) {
    cl.add("webex-correct");
    cl.remove("webex-incorrect");
  } else {
    cl.add("webex-incorrect");
    cl.remove("webex-correct");
  }

  // match numeric answers within a specified tolerance
  if(this.dataset.tol > 0){
    var tol = JSON.parse(this.dataset.tol);
    var matches = real_answers.map(x => Math.abs(x - my_answer) < tol)
    if (matches.reduce((a, b) => a + b, 0) > 0) {
      cl.add("webex-correct");
    } else {
      cl.remove("webex-correct");
    }
  }

  // added regex bit
  if (cl.contains("regex")){
    answer_regex = RegExp(real_answers.join("|"))
    if (answer_regex.test(my_answer)) {
      cl.add("webex-correct");
    }
  }

  update_total_correct();
}

/* function for checking select answers */
select_func = function(e) {
  console.log("webex: check select");

  var cl = this.classList

  /* add style */
  cl.remove("webex-incorrect");
  cl.remove("webex-correct");
  if (this.value == "answer") {
    cl.add("webex-correct");
  } else if (this.value != "blank") {
    cl.add("webex-incorrect");
  }

  update_total_correct();
}

/* function for checking radiogroups answers */
radiogroups_func = function(e) {
  console.log("webex: check radiogroups");

  var checked_button = document.querySelector('input[name=' + this.id + ']:checked');
  var cl = checked_button.parentElement.classList;
  var labels = checked_button.parentElement.parentElement.children;

  /* get rid of styles */
  for (i = 0; i < labels.length; i++) {
    labels[i].classList.remove("webex-incorrect");
    labels[i].classList.remove("webex-correct");
  }

  /* add style */
  if (checked_button.value == "answer") {
    cl.add("webex-correct");
  } else {
    cl.add("webex-incorrect");
  }

  update_total_correct();
}

window.onload = function() {
  console.log("webex onload");
  /* set up solution buttons */
  var buttons = document.getElementsByTagName("button");

  for (var i = 0; i < buttons.length; i++) {
    if (buttons[i].parentElement.classList.contains('webex-solution')) {
      buttons[i].onclick = b_func;
    }
  }

  /* set up webex-solveme inputs */
  var solveme = document.getElementsByClassName("webex-solveme");

  for (var i = 0; i < solveme.length; i++) {
    /* make sure input boxes don't auto-anything */
    solveme[i].setAttribute("autocomplete","off");
    solveme[i].setAttribute("autocorrect", "off");
    solveme[i].setAttribute("autocapitalize", "off");
    solveme[i].setAttribute("spellcheck", "false");
    solveme[i].value = "";

    /* adjust answer for ignorecase or nospaces */
    var cl = solveme[i].classList;
    var real_answer = solveme[i].dataset.answer;
    if (cl.contains("ignorecase")) {
      real_answer = real_answer.toLowerCase();
    }
    if (cl.contains("nospaces")) {
      real_answer = real_answer.replace(/ /g, "");
    }
    solveme[i].dataset.answer = real_answer;

    /* attach checking function */
    solveme[i].onkeyup = solveme_func;
    solveme[i].onchange = solveme_func;

    $(solveme[i]).after(" <span class='webex-icon'></span>");
  }

  /* set up radiogroups */
  var radiogroups = document.getElementsByClassName("webex-radiogroup");
  for (var i = 0; i < radiogroups.length; i++) {
    radiogroups[i].onchange = radiogroups_func;
  }

  /* set up selects */
  var selects = document.getElementsByClassName("webex-select");
  for (var i = 0; i < selects.length; i++) {
    selects[i].onchange = select_func;
    $(selects[i]).after(" <span class='webex-icon'></span>");
  }

  update_total_correct();
}

</script><script>
$( document ).ready(function() {
  var cite = ' ';
  var psyteachr = ' <a href="https://psyteachr.github.io/"><img src="images/logos/psyteachr_logo.png" style="height: 31px; color: white;" alt="psyTeachR: Reproducible Research" /></a>';
  var license = ' <a rel="license" href="https://creativecommons.org/licenses/by-sa/4.0/" target="blank"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-sa/4.0/88x31.png"></a>';

  $("footer div.row div:eq(1) p").html(
    psyteachr + license + cite
  );

  function move_sidebar() {
    var w = window.innerWidth;
    if (w < 992) {
      $("#toc").appendTo($("#main-nav"));
    } else {
      $("#toc").appendTo($("div.sidebar-chapter"));
    }
  }
  move_sidebar();
  window.onresize = move_sidebar;
});
</script><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><nav class="page-navigation"><div class="nav-page nav-page-previous">
      <a href="./08-tidy.html" class="pagination-link" aria-label="Data Tidying">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Data Tidying</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./10-custom.html" class="pagination-link" aria-label="Customising Visualisations &amp; Reports">
        <span class="nav-page-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Customising Visualisations &amp; Reports</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer"><div class="nav-footer">
    <div class="nav-footer-left">
<p>CC-BY 2022, healthTeachR</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    <div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/healthteachr/healthteachr.github.io/edit/main/09-wrangle.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/healthteachr/healthteachr.github.io/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li><li><a href="https://github.com/healthteachr/healthteachr.github.io/blob/main/09-wrangle.qmd" class="toc-action"><i class="bi empty"></i>View source</a></li></ul></div></div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>


</body></html>